// Copyright 2023 OneTab Ltd.  All rights reserved.
const U="1.76",ct=!1,ut=!1,lt=!1,ft=!1,dt=!1,wt=!1,ht=!0,pt="chrome://",gt="chrome://newtab/",mt="https://www.one-tab.com",xt=!1,yt=!1,bt=!1;async function h(){return new Promise((t,e)=>{document.readyState==="complete"?t():document.addEventListener("readystatechange",n=>{document.readyState==="complete"&&t()})})}function Lt(t){return l(void 0,"div",{id:"headerText",style:{paddingTop:"40px",paddingBottom:"20px",[`padding${it()}`]:"240px",fontSize:"16px",color:"var(--text-color-weak)",fontWeight:"300",borderBottom:"1px dashed var(--dash-color)",marginBottom:"10px"},textContent:t}).o}function F(t,e,n){return l(void 0,"picture",{style:{...t},...e,children:{P:l(void 0,"source",{srcset:n(!0),media:"(prefers-color-scheme: light)"}),C:l(void 0,"source",{srcset:n(!1),media:"(prefers-color-scheme: dark)"}),v:l(void 0,"img",{style:{width:"100%",height:"100%"}})}}).o}function St(){return F({width:416/2+"px",height:114/2+"px",position:"absolute",top:"16px",[`${at()}`]:"19px"},{},t=>`images/top-left-logo-${t?"light":"dark"}${s()?"":"-rtl"}.png`)}function Pt(t,e,n){let r=document.createElement("div"),o=document.createElement("div");T(o,"30px"),o.style.position="relative";let i=document.createElement("img");i.src=t?"images/twister-open.png":"images/twister-closed"+(s()?"":"-rtl")+".png",i.style.width=48/2+"px",i.style.height=50/2+"px",i.style.position="absolute",st(i,"0px"),i.style.top="0px",o.textContent=e,o.style.fontSize="16px",o.style.cursor="pointer",r.appendChild(o),o.appendChild(i);let a=document.createElement("div");T(a,"30px"),a.style.paddingTop="10px",a.appendChild(n.o),a.style.display=t?"block":"none",r.appendChild(a),o.onclick=()=>{t=!t,i.src=t?"images/twister-open.png":"images/twister-closed"+(s()?"":"-rtl")+".png",a.style.display=t?"block":"none"};let u={D:n.o};return Object.assign(u,n),u.o=r,u}function Ct(t,e,n,r){let o=document.createElement("div");o.style.fontSize=e+"px",o.className="clickable";let i=document.createElement("span");if(r){let a=document.createElement("span");a.textContent=E("newExclamation")+" ",i.appendChild(a)}return typeof t=="string"?i.appendChild(document.createTextNode(t)):i.appendChild(t),i.style.verticalAlign="middle",i.onclick=a=>{n(i)},o.appendChild(i),o}const x=chrome.runtime.getURL("onetab.html"),y=x.substring(0,x.length-"onetab.html".length);let b=!0;async function Et(){return b?(await chrome.permissions.getAll()).permissions.includes("tabGroups")&&chrome.tabGroups:!1}async function vt(){if(!b)return!1;try{return await chrome.permissions.request({permissions:["tabGroups"]})}catch(t){return console.log('chrome.permissions.request for "tabGroups" permission failed with error:'),console.log(t),!1}}function Dt(t){let e=L(t);return e.toLowerCase().startsWith("www.")?e.substring("www.".length):e}function L(t){return t?(t.indexOf("//")===0&&(t="http:"+t),t.indexOf("://")===-1&&(t="http://"+t),t=t.substring(t.indexOf("://")+"://".length),t.indexOf("/")!==-1&&(t=t.substring(0,t.indexOf("/"))),t.indexOf(":")!==-1&&(t=t.substring(0,t.indexOf(":"))),t.indexOf("?")!==-1&&(t=t.substring(0,t.indexOf("?"))),t.indexOf("#")!==-1&&(t=t.substring(0,t.indexOf("#"))),t.toLowerCase()):"undefined"}function It(t){return t.indexOf("://")===-1?"https://":(t=t.substring(0,t.indexOf("://")+"://".length),t.toLowerCase())}let S=["com","co.uk","org.uk","net","org","de","ru","info","xyz","nl"];function Mt(t){let e=L(t);try{for(let n in S){let r="."+S[n];if(B(e,r)){for(e=e.substring(0,e.length-r.length);e.indexOf(".")!==-1;)e=e.substring(e.indexOf(".")+1);e=e+r;break}}return e.indexOf("www.")===0&&(e=e.substring("www.".length)),e}catch{return e}}function R(t){t.noCacheRandom=k()}function k(){return new Date().getTime()+Math.round(Math.random()*1e4)+""}async function Tt(t,e){R(e);let n=JSON.stringify(e);return await(await A(t,n)).json()}async function A(t,e){let n={};e?(n.method="POST",n.body=e):n.method="GET",n.headers=new Headers,n.headers.append("Content-Type","text/json");let r=await fetch(t,n);if(r.status===200)return r;throw new Error("http response code"+r.status)}function Ut(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const G="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("");function j(t,e){let n=G,r=[],o=0;for(e=e||n.length,t=t||22,o=0;o<t;o++)r[o]=n[0|Math.random()*e];return r.join("")}function $(){return j()}function Ft(){return $()}function Rt(t){return t==null?"":t.replace(/^\s+/,"").replace(/\s+$/,"")}function kt(...t){return(e,n)=>t.reduce((r,o)=>r||o(e,n),0)}function At(t){return(e,n)=>t(e)-t(n)}function Gt(t){return(e,n)=>t(n)-t(e)}const jt=(t,e)=>!!e.starred-!!t.starred||t.starred&&e.starred&&e.starredDate-t.starredDate||e.createDate-t.createDate;function $t(t){return t||(t=""),t.replace(/[\x00-\x1F\x7F-\x9F]/g,"")}function B(t,e){return t?t.indexOf(e,t.length-e.length)!==-1:!1}const N={restoreWindow:"newWindow",pinnedTabs:"ignore",startupLaunch:"displayOneTab",restoreRemoval:"default",duplicates:"allow",pinned:"true"};function Bt(t,e){return e[t]?e[t]:N[t]}function Nt(t,e,n){t.parentNode&&t.remove(),e.insertBefore(t,n===void 0||n>=e.children.length||e.children.length===0?null:e.children[Math.max(0,n)])}function l(t,e,n){let r=e===void 0?t:document.createElement(e),o={};if(n){n.style&&Object.assign(r.style,n.style);for(let a of Object.keys(n))a!=="style"&&a!=="children"&&(r[a]=n[a]);if(n.children)for(const[a,u]of Object.entries(n.children))o[a]=u,r.appendChild(u instanceof HTMLElement?u:u.o);n.l&&r.appendChild(n.l),n.init&&n.init(r)}e!==void 0&&t&&t.appendChild(r);let i={o:r};return Object.assign(i,o),i}const P="about:reader?url=";function Ot(t){return t?t.indexOf(":")===-1?"https://"+t:t.indexOf(P)===0?decodeURIComponent(t.substring(P.length)):t.startsWith(`${y}placeholder.html?`)?new URLSearchParams(t.substring(t.indexOf("?"))).get("url"):t:""}function Ht(t){return parseInt(t.match(/\d+/)[0])}const C=[...new Array(30)].map((t,e)=>parseInt(10+Math.pow(1.6,e)));function*O(t){let e=0;for(;C.slice(0,e).reduce((n,r)=>n+r,0)<t;)yield C[e++]}async function _t(t,e,n){let r=0;for(let o of O(t)){if(await n(r))return;await p(o),r+=o}throw new Error(`Timeout waiting for condition ${e}`)}function E(t){let e=chrome.i18n.getMessage(t);return e||(console.log("No translation available for: "+t),t)}function Wt(t,e,n){return e=!1,((t||"").toLowerCase().startsWith("file:")||H(t))&&e?n?`data:text/html, <html><body><div id="placeholderUrl">${t}</div></body></html>`:`${y}placeholder.html?url=${encodeURI(t)}`:t}function H(t){for(let e of _)if(t.startsWith(e))return!0;return!!(!t||t===""||t.startsWith("chrome-devtools:"))}const _=["javascript:","about:",...["chrome://","edge://","data:"].filter(t=>!1),...["edge://","chrome://"].map(t=>["newtab","new-tab-page","print","network-error","badcastcrash","inducebrowsercrashforrealz","crash","crashdump","kill","hang","shorthang","gpuclean","gpucrash","gpuhang","memory-exhaust","memory-pressure-critical","memory-pressure-moderate","ppapiflashcrash","ppapiflashhang","quit","restart"].map(e=>`${t}${e}/`)).flat()];async function p(t){return new Promise(e=>setTimeout(e,t))}class W{async put(e,n){await chrome.storage.local.set({[e]:n})}async get(e){return(await chrome.storage.local.get([e]))[e]}async remove(e){return await chrome.storage.local.remove(e)}}const z=new W;function f(){return z}const V="undefined-34LKmiHxP3Mu48u8qrDaHf";function g(t,e,n){return Array.isArray(t)?t.map(r=>g(r,e,n)):typeof t=="object"&&t!==null?Object.fromEntries(Object.entries(t).map(([r,o])=>[r,g(o,e,n)])):t===e?n:t}const zt="c",Vt="e",qt="tg";class q{async put(e,n){await chrome.storage.session.set({[e]:n})}async get(e){return(await chrome.storage.session.get([e]))[e]}async getAll(){return await chrome.storage.session.get(null)}async remove(e){return await chrome.storage.session.remove(e)}async clearAll(){await chrome.storage.session.clear()}}class J{async put(e,n){await f().put("sessionStore",{...await this.getAll(),[e]:n})}async get(e){return(await this.getAll())[e]}async getAll(){return await f().get("sessionStore")??{}}async remove(e){let n=await this.getAll();delete n[e],await f().put("sessionStore",n)}async clearAll(){await f().remove("sessionStore")}}const K=chrome.storage.session?new q:new J;function Jt(){return K}class w{constructor(e,n){this.x=e,this.y=n}h(e){return new w(this.x-e.x,this.y-e.y)}}class v{constructor(e,n,r,o){this.p=e,this.type=n,this.listener=r,this.g=o}remove(){this.p.removeEventListener(this.type,this.listener,this.g)}}function Kt(t,e){t.onmousemove=n=>{e(new c(t,n))}}function Xt(t,e){t.onmousedown=n=>{e(new c(t,n))}}function Yt(t,e){t.onmouseover=n=>{e(new c(t,n))}}function Qt(t,e){t.onmouseup=n=>{e(new c(t,n))}}function Zt(t,e){t.onmouseout=n=>{e(new c(t,n))}}function te(t,e){t.onclick=n=>{e(new c(t,n))}}function ee(t,e){t.ondblclick=n=>{e(new c(t,n))}}function ne(t,e){d(t,"click",e)}function re(t,e){d(t,"dblclick",e)}function oe(t,e){return d(t,"mouseover",e)}function ie(t,e){return d(t,"mouseup",e)}function ae(t,e){let n;return n=r=>{let o,i;o=r.currentTarget,i=r.relatedTarget,o===t&&o!==i&&!m(o,i)&&e(new c(t,r))},t.addEventListener("mouseout",n,!1),new v(t,"mouseout",n,!1)}function se(t,e){t.onmouseout=n=>{let r,o;r=n.currentTarget,o=n.relatedTarget,r===t&&r!==o&&!m(r,o)&&e(new c(t,n))}}function ce(t,e){for(let n of t)n.onmouseout=X(n,t,e)}function X(t,e,n){return r=>{let o,i;if(o=r.currentTarget,i=r.relatedTarget,o===t&&o!==i&&!m(o,i)){for(let a of e)if(i===a)return;n(new c(t,r))}}}function m(t,e){try{if(!e)return!1;for(;e.parentNode;)if((e=e.parentNode)===t)return!0;return!1}catch{return!1}}class c{constructor(e,n){this.element=e,this.event=n,this.i=null,this.u=null}m(){if(this.i===null){let e=Y(this.element);this.i=e.x,this.u=e.y}return this.i}I(){return this.i===null&&this.m(),this.u}}function d(t,e,n){let r=o=>{let i=new c(t,o);n(i)};return t.addEventListener(e,r,!1),new v(t,e,r,!1)}function ue(t){return D(t)}function Y(t,e){return D(e).h(Q(t))}function D(t){let e,n;return e=t.clientX+window.scrollX,n=t.clientY+window.scrollY,new w(e,n)}function Q(t){let e=t,n=0,r=0;for(;;){let o=e.offsetParent;if(o===null)break;n+=e.offsetLeft,r+=e.offsetTop,e=o}return new w(n,r)}function le(){return window.scrollY}function fe(){return window.scrollX}async function de(){await Z(),await h(),ot()}async function Z(){try{await chrome.tabs.update((await chrome.tabs.getCurrent()).id,{autoDiscardable:!1})}catch(t){console.log(t)}}function we(t){if(typeof t=="string"&&(t=document.getElementById(t)),!!t)for(;t.childNodes.length>0;)t.childNodes[0].remove()}function he(t){return l(void 0,"div",{style:{fontSize:"1px",height:t+"px",width:"1px"}}).o}let I=!1;async function tt(t,e={}){if(!I){const r=async()=>{if((await chrome.runtime.sendMessage({args:[],type:et.U,L:!0}))?.result?.pong!==String(U))throw new Error};try{await r()}catch{console.log("core not ready. retrying..."),await p(1e3);try{await r()}catch{console.log("core not ready. retrying..."),await p(5e3);try{await r()}catch{throw new Error("Cannot connect to core")}}}I=!0}e.type=t,e.L=!0;let n=await chrome.runtime.sendMessage(e);if(n===null)throw new Error("null message response from core");if(n?.S)throw new Error(n.S);return n.result}function pe(t){chrome.runtime.onMessage.addListener((e,n,r)=>{e.type==="stateChange"&&t(e.F)})}const et=new Proxy({},{get(t,e){return e}}),ge=new Proxy({},{get(t,e,n){return(...r)=>(r=g(r,void 0,V),tt(e,{args:r}))}});let nt=navigator.language||navigator.userLanguage;function rt(){let t=["ar","he","fa","ps","ur"],e=nt.split("-",1)[0];return t.indexOf(e)>=0?"rtl":"ltr"}let M=rt();function s(){return M!=="rtl"}function ot(){document.getElementsByTagName("html")[0].dir=M}function it(){return s()?"Left":"Right"}function me(){return s()?"Right":"Left"}function at(){return s()?"left":"right"}function xe(){return s()?"right":"left"}function st(t,e){s()?t.style.left=e:t.style.right=e}function ye(t,e){s()?t.style.right=e:t.style.left=e}function T(t,e){s()?t.style.paddingLeft=e:t.style.paddingRight=e}function be(t,e){s()?t.style.paddingRight=e:t.style.paddingLeft=e}function Le(t,e){s()?t.style.marginLeft=e:t.style.marginRight=e}(async()=>{await h();const t=document.getElementById("copyButton");let n=new URLSearchParams(window.location.search).get("url"),r=document.getElementById("urlInput");r.value=n;let o=n;["/","\\"].forEach(i=>{o.includes(i)&&(o=o.substring(o.lastIndexOf(i)+1))}),document.title=o,document.getElementById("filename").textContent=o,t.onclick=i=>{r.select(),navigator.clipboard.writeText(r.value)}})(),(async()=>(await h(),[...document.querySelectorAll("[data-m]")].forEach(t=>t.textContent=E(t.dataset.m))))();
