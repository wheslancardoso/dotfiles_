var d="MAX_AI_CHAT_GPT_MESSAGE_KEY",l=!1,i=[],u=window.fetch,r=(n,p)=>u(n,p).then(function(t){return new Promise(s=>{if(l&&["https://chat.openai.com/backend-api/files","https://chat.openai.com/backend-api/conversation/interpreter/process_upload"].includes(n)){let e=t.clone(),a=n==="https://chat.openai.com/backend-api/files"?1:2;e.json().then(c=>{if(window.postMessage({event:d,type:"upload_change",data:{status:t.status,url:n,result:c,progress:a===2?100:80,done:a===2}}),a===2){c.status="error";let o=new Response(JSON.stringify(c),{status:t.status,statusText:t.statusText,headers:t.headers});l=!1,s(o)}s(t)}).catch(c=>{s(t)})}else s(t)})});window.fetch=r;var h=()=>document.querySelector('input[type="file"]');window.addEventListener("message",n=>{var p;if(((p=n.data)==null?void 0:p.event)===d){let{type:t,data:s}=n.data;switch(t){case"ping":{let{taskId:e}=s,a=!!h();window.postMessage({event:d,type:"pong",data:{taskId:e,success:a}})}break;case"upload":{let{files:e,taskId:a}=s;i=e,l=!0,window.postMessage({event:d,type:"upload_result",data:{taskId:a,success:!0}})}break;case"upload_change":{let{result:e,progress:a,done:c}=s,o=i[0];e.status==="success"?(o.uploadProgress=a,o.uploadStatus=c?"success":"uploading",o.uploadedUrl=e==null?void 0:e.download_url):(o.uploadProgress=0,o.uploadStatus="error",o.uploadErrorMessage=(e==null?void 0:e.error)||"upload error"),window.postMessage({event:d,type:"upload_change_result",data:{files:i}})}break;default:break}}});
