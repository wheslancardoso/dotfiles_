import{a as Or}from"./chunks/H3PGMVCC.js";import{M as Er,N as kr,_ as xr,ba as qe,ea as Fr,fa as mt,ka as Ne,la as yt,ma as Rr}from"./chunks/I2XYMP7X.js";import"./chunks/ABULMT32.js";import"./chunks/MKFZQTYG.js";import"./chunks/4SC7XEKB.js";import"./chunks/23DIE7BK.js";import"./chunks/ON4Q5ESC.js";import"./chunks/REMB6LXX.js";import{A as R,E as wr,F as _r,G as br,H as ue,I as Ge,K as Ir,L as Ar,M as Pr,O as dt,S as Sr,T as j,U as Tr,V as D,X as x,Y as W,Z as Me,_ as Q,a as _,ba as ft,c as Ue,ca as Be,ea as De,r as Le,y as B}from"./chunks/BK6QTIUI.js";import{L as Cr}from"./chunks/VYGUKUEK.js";import"./chunks/X6PP3PBE.js";import{a as k}from"./chunks/JS22TWPO.js";import{A as Oe,F as yr,G as M,H as gr,I as vr,J as pt,d as ee,e as H,f as mr,s as w,v as Re,z as ht}from"./chunks/BR2YNKDZ.js";import"./chunks/BIAB2ZEP.js";import{b as f,e as P}from"./chunks/O5NYTI7P.js";var rs=f((Hu,ts)=>{"use strict";function Yr(s){return(Yr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(s)}function de(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function Kr(s,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,r.key,r)}}function fe(s,e,t){return e&&Kr(s.prototype,e),t&&Kr(s,t),s}function Wi(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),e&&Zr(s,e)}function It(s){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(s)}function Zr(s,e){return(Zr=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(s,e)}function Qi(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Vi(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function zi(s,e){return!e||typeof e!="object"&&typeof e!="function"?Vi(s):e}function Ji(s){var e=Qi();return function(){var t,r=It(s);if(e){var n=It(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return zi(this,t)}}function Xr(s){return Ki(s)||Xi(s)||Yi(s)||Zi()}function Ki(s){if(Array.isArray(s))return At(s)}function Xi(s){if(typeof Symbol<"u"&&Symbol.iterator in Object(s))return Array.from(s)}function Yi(s,e){if(s){if(typeof s=="string")return At(s,e);var t=Object.prototype.toString.call(s).slice(8,-1);return t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set"?Array.from(s):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?At(s,e):void 0}}function At(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=s[t];return r}function Zi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Pt=function(){function s(e){de(this,s),this._listeners=[],this._mute=!1,this._accumulate=!1,this._accumulatedEvents=[],this._name=e||"",this._onListenerAdded=null,this._onFirstListenerAdded=null,this._onListenerRemoved=null,this._onLastListenerRemoved=null}return fe(s,[{key:"addListener",value:function(e,t){this._pushListener(e,t,!1)}},{key:"addOnceListener",value:function(e,t){this._pushListener(e,t,!0)}},{key:"removeListener",value:function(e,t){this._ensureListener(e);var r=this._indexOfListener(e,t);0<=r&&this._spliceListener(r)}},{key:"removeAllListeners",value:function(){for(;this.hasListeners();)this._spliceListener(0)}},{key:"hasListener",value:function(e,t){return this._ensureListener(e),0<=this._indexOfListener(e,t)}},{key:"hasListeners",value:function(){return 0<this._listeners.length}},{key:"dispatch",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invokeListeners({args:t,async:!1})}},{key:"dispatchAsync",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._invokeListeners({args:t,async:!0})}},{key:"mute",value:function(e){var t=0<arguments.length&&e!==void 0?e:{};this._mute=!0,t.accumulate?this._accumulate=!0:(this._accumulate=!1,this._accumulatedEvents=[])}},{key:"unmute",value:function(){this._mute=!1,this._accumulate&&(this._dispatchAccumulated(),this._accumulate=!1)}},{key:"_invokeListeners",value:function(e){var t=this,r=0<arguments.length&&e!==void 0?e:{args:[],async:!1};this._mute?this._accumulate&&this._accumulatedEvents.push(r):this._listeners.slice().forEach(function(n){t._invokeListener(n,r),n.once&&t.removeListener(n.callback,n.context)})}},{key:"_invokeListener",value:function(e,t){var r,n,i=e.callback instanceof s;t.async?i?(r=e.callback).dispatchAsync.apply(r,Xr(t.args)):setTimeout(function(){return e.callback.apply(e.context,t.args)},0):i?(n=e.callback).dispatch.apply(n,Xr(t.args)):e.callback.apply(e.context,t.args)}},{key:"_ensureListener",value:function(e){if(!s.isValidListener(e))throw new Error("Channel "+this._name+": listener is not a function and not a Channel")}},{key:"_dispatchInnerAddEvents",value:function(){var e,t;this._onListenerAdded&&(e=this._onListenerAdded).dispatch.apply(e,arguments),this._onFirstListenerAdded&&this._listeners.length===1&&(t=this._onFirstListenerAdded).dispatch.apply(t,arguments)}},{key:"_dispatchInnerRemoveEvents",value:function(){var e,t;this._onListenerRemoved&&(e=this._onListenerRemoved).dispatch.apply(e,arguments),this._onLastListenerRemoved&&this._listeners.length===0&&(t=this._onLastListenerRemoved).dispatch.apply(t,arguments)}},{key:"_indexOfListener",value:function(e,t){for(var r=0;r<this._listeners.length;r++){var n=this._listeners[r],i=n.callback===e,u=e instanceof s,o=t===void 0&&n.context===void 0,p=t===n.context;if(i&&(u||o||p))return r}}},{key:"_dispatchAccumulated",value:function(){var e=this;this._accumulatedEvents.forEach(function(t){return e._invokeListeners(t)}),this._accumulatedEvents=[]}},{key:"_pushListener",value:function(e,t,r){this._ensureListener(e),this._checkForDuplicates(e,t),this._listeners.push({callback:e,context:t,once:r}),this._dispatchInnerAddEvents(e,t,r)}},{key:"_checkForDuplicates",value:function(e,t){if(this.hasListener(e,t))throw new Error("Channel "+this._name+": duplicating listeners")}},{key:"_spliceListener",value:function(e){var t=this._listeners[e],r=t.callback,n=t.context,i=t.once;this._listeners.splice(e,1),this._dispatchInnerRemoveEvents(r,n,i)}},{key:"onListenerAdded",get:function(){return this._onListenerAdded||(this._onListenerAdded=new s("".concat(this._name,":onListenerAdded"))),this._onListenerAdded}},{key:"onFirstListenerAdded",get:function(){return this._onFirstListenerAdded||(this._onFirstListenerAdded=new s("".concat(this._name,":onFirstListenerAdded"))),this._onFirstListenerAdded}},{key:"onListenerRemoved",get:function(){return this._onListenerRemoved||(this._onListenerRemoved=new s("".concat(this._name,":onListenerRemoved"))),this._onListenerRemoved}},{key:"onLastListenerRemoved",get:function(){return this._onLastListenerRemoved||(this._onLastListenerRemoved=new s("".concat(this._name,":onLastListenerRemoved"))),this._onLastListenerRemoved}}],[{key:"isValidListener",value:function(e){return typeof e=="function"||e instanceof s}}]),s}(),eo=function(){function s(){de(this,s),this._channels=new Map}return fe(s,[{key:"addListener",value:function(e,t,r){this._getChannel(e).addListener(t,r)}},{key:"on",value:function(e,t,r){this.addListener(e,t,r)}},{key:"addOnceListener",value:function(e,t,r){this._getChannel(e).addOnceListener(t,r)}},{key:"once",value:function(e,t,r){this.addOnceListener(e,t,r)}},{key:"removeListener",value:function(e,t,r){this._getChannel(e).removeListener(t,r)}},{key:"off",value:function(e,t,r){this.removeListener(e,t,r)}},{key:"hasListener",value:function(e,t,r){return this._getChannel(e).hasListener(t,r)}},{key:"has",value:function(e,t,r){return this.hasListener(e,t,r)}},{key:"hasListeners",value:function(e){return this._getChannel(e).hasListeners()}},{key:"dispatch",value:function(e){for(var t,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this._getChannel(e)).dispatch.apply(t,n)}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.dispatch.apply(this,[e].concat(r))}},{key:"_getChannel",value:function(e){return this._channels.has(e)||this._channels.set(e,new Pt(e)),this._channels.get(e)}}]),s}(),to=function(){function s(e){de(this,s),this._params=e,this._isOn=!1,this._assertParams()}return fe(s,[{key:"on",value:function(){if(!this._isOn){var e=this._params.channel,t=e.addListener||e.addEventListener||e.on;this._applyMethod(t),this._isOn=!0}}},{key:"off",value:function(){if(this._isOn){var e=this._params.channel,t=e.removeListener||e.removeEventListener||e.off;this._applyMethod(t),this._isOn=!1}}},{key:"_applyMethod",value:function(e){var t=this._params,r=t.channel,n=t.event,i=t.listener,u=n?[n,i]:[i];e.apply(r,u)}},{key:"_assertParams",value:function(){var e=this._params,t=e.channel,r=e.event,n=e.listener;if(!t||Yr(t)!=="object")throw new Error("Channel should be object");if(r&&typeof r!="string")throw new Error("Event should be string");if(!n||!Pt.isValidListener(n))throw new Error("Listener should be function or Channel")}}]),s}(),es=function(){function s(e){de(this,s),this._items=e.map(function(t){return new to(t)})}return fe(s,[{key:"on",value:function(){return this._items.forEach(function(e){return e.on()}),this}},{key:"off",value:function(){return this._items.forEach(function(e){return e.off()}),this}}]),s}(),ro=function(){Wi(e,es);var s=Ji(e);function e(t,r){var n;return de(this,e),(n=s.call(this,r))._overrideComponentCallback(t,"componentDidMount","on"),n._overrideComponentCallback(t,"componentWillUnmount","off"),n}return fe(e,[{key:"_overrideComponentCallback",value:function(t,r,n){var i=this,u=t[r];t[r]=function(){if(i[n](),typeof u=="function"){for(var o=arguments.length,p=new Array(o),a=0;a<o;a++)p[a]=arguments[a];return u.apply(t,p)}}}}]),e}(),je=Pt;je.EventEmitter=eo,je.Subscription=es,je.ReactSubscription=ro,ts.exports=je});var ns=f((Wu,ss)=>{ss.exports={timeout:0,timeoutReason:"Promise rejected by PromiseController timeout {timeout} ms.",resetReason:"Promise rejected by PromiseController reset."}});var as=f($e=>{$e.isPromise=function(s){return s&&typeof s.then=="function"};$e.tryCall=function(s){return typeof s=="function"?s():s};$e.createErrorType=function(s){function e(t){Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t}return e.prototype=new Error,e.prototype.name=s,e.prototype.constructor=e,e}});var St=f((Vu,us)=>{var so=ns(),{isPromise:is,createErrorType:cs,tryCall:os}=as(),V=class{constructor(e){this._options=Object.assign({},so,e),this._resolve=null,this._reject=null,this._isPending=!1,this._isFulfilled=!1,this._isRejected=!1,this._value=void 0,this._promise=null,this._timer=null}get promise(){return this._promise}get value(){return this._value}get isPending(){return this._isPending}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isSettled(){return this._isFulfilled||this._isRejected}call(e){return this._isPending||(this.reset(),this._createPromise(),this._createTimer(),this._callFn(e)),this._promise}resolve(e){this._isPending&&(is(e)?this._tryAttachToPromise(e):(this._settle(e),this._isFulfilled=!0,this._resolve(e)))}reject(e){this._isPending&&(this._settle(e),this._isRejected=!0,this._reject(e))}reset(){if(this._isPending){let e=os(this._options.resetReason),t=new V.ResetError(e);this.reject(t)}this._promise=null,this._isPending=!1,this._isFulfilled=!1,this._isRejected=!1,this._value=void 0,this._clearTimer()}configure(e){Object.assign(this._options,e)}_createPromise(){this._promise=new Promise((e,t)=>{this._isPending=!0,this._resolve=e,this._reject=t})}_handleTimeout(){let e=os(this._options.timeoutReason),t=typeof e=="string"?e.replace("{timeout}",this._options.timeout):"",r=new V.TimeoutError(t);this.reject(r)}_createTimer(){this._options.timeout&&(this._timer=setTimeout(()=>this._handleTimeout(),this._options.timeout))}_clearTimer(){this._timer&&(clearTimeout(this._timer),this._timer=null)}_settle(e){this._isPending=!1,this._value=e,this._clearTimer()}_callFn(e){if(typeof e=="function")try{let t=e();this._tryAttachToPromise(t)}catch(t){this.reject(t)}}_tryAttachToPromise(e){is(e)&&e.then(t=>this.resolve(t),t=>this.reject(t))}};V.TimeoutError=cs("TimeoutError");V.ResetError=cs("ResetError");us.exports=V});var ls=f(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.PromisedMap=void 0;var no=function(){function s(){this.map=new Map}return Object.defineProperty(s.prototype,"size",{get:function(){return this.map.size},enumerable:!1,configurable:!0}),s.prototype.set=function(e,t){var r=this.createMapItem(t);return this.map.set(e,r),r.promise},s.prototype.get=function(e){var t=this.map.get(e);return t&&t.data},s.prototype.has=function(e){return this.map.has(e)},s.prototype.delete=function(e){return this.map.delete(e)},s.prototype.resolve=function(e,t){var r=this.map.get(e);r&&(this.delete(e),r.resolve(t))},s.prototype.reject=function(e,t){var r=this.map.get(e);r&&(this.delete(e),r.reject(t))},s.prototype.resolveAll=function(e){this.map.forEach(function(t){return t.resolve(e)}),this.map.clear()},s.prototype.rejectAll=function(e){this.map.forEach(function(t){return t.reject(e)}),this.map.clear()},s.prototype.forEach=function(e){this.map.forEach(function(t,r,n){return e(t.data,r,n)})},s.prototype.clear=function(){return this.map.clear()},s.prototype.createMapItem=function(e){var t={data:e};return t.promise=new Promise(function(r,n){t.resolve=r,t.reject=n}),t},s}();He.PromisedMap=no});var ps=f((Ju,hs)=>{"use strict";var ao="Function.prototype.bind called on incompatible ",Tt=Array.prototype.slice,io=Object.prototype.toString,oo="[object Function]";hs.exports=function(e){var t=this;if(typeof t!="function"||io.call(t)!==oo)throw new TypeError(ao+t);for(var r=Tt.call(arguments,1),n,i=function(){if(this instanceof n){var c=t.apply(this,r.concat(Tt.call(arguments)));return Object(c)===c?c:this}else return t.apply(e,r.concat(Tt.call(arguments)))},u=Math.max(0,t.length-r.length),o=[],p=0;p<u;p++)o.push("$"+p);if(n=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")(i),t.prototype){var a=function(){};a.prototype=t.prototype,n.prototype=new a,a.prototype=null}return n}});var We=f((Ku,ds)=>{"use strict";var co=ps();ds.exports=Function.prototype.bind||co});var ms=f((Xu,fs)=>{"use strict";fs.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var u=Object.getOwnPropertyDescriptor(e,t);if(u.value!==n||u.enumerable!==!0)return!1}return!0}});var vs=f((Yu,gs)=>{"use strict";var ys=typeof Symbol<"u"&&Symbol,uo=ms();gs.exports=function(){return typeof ys!="function"||typeof Symbol!="function"||typeof ys("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:uo()}});var z=f((Zu,Cs)=>{"use strict";var lo=We();Cs.exports=lo.call(Function.call,Object.prototype.hasOwnProperty)});var U=f((el,As)=>{"use strict";var g,ne=SyntaxError,Is=Function,se=TypeError,Et=function(s){try{return Is('"use strict"; return ('+s+").constructor;")()}catch{}},X=Object.getOwnPropertyDescriptor;if(X)try{X({},"")}catch{X=null}var kt=function(){throw new se},ho=X?function(){try{return arguments.callee,kt}catch{try{return X(arguments,"callee").get}catch{return kt}}}():kt,te=vs()(),q=Object.getPrototypeOf||function(s){return s.__proto__},re={},po=typeof Uint8Array>"u"?g:q(Uint8Array),Y={"%AggregateError%":typeof AggregateError>"u"?g:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?g:ArrayBuffer,"%ArrayIteratorPrototype%":te?q([][Symbol.iterator]()):g,"%AsyncFromSyncIteratorPrototype%":g,"%AsyncFunction%":re,"%AsyncGenerator%":re,"%AsyncGeneratorFunction%":re,"%AsyncIteratorPrototype%":re,"%Atomics%":typeof Atomics>"u"?g:Atomics,"%BigInt%":typeof BigInt>"u"?g:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?g:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?g:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?g:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?g:Float32Array,"%Float64Array%":typeof Float64Array>"u"?g:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?g:FinalizationRegistry,"%Function%":Is,"%GeneratorFunction%":re,"%Int8Array%":typeof Int8Array>"u"?g:Int8Array,"%Int16Array%":typeof Int16Array>"u"?g:Int16Array,"%Int32Array%":typeof Int32Array>"u"?g:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":te?q(q([][Symbol.iterator]())):g,"%JSON%":typeof JSON=="object"?JSON:g,"%Map%":typeof Map>"u"?g:Map,"%MapIteratorPrototype%":typeof Map>"u"||!te?g:q(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?g:Promise,"%Proxy%":typeof Proxy>"u"?g:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?g:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?g:Set,"%SetIteratorPrototype%":typeof Set>"u"||!te?g:q(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?g:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":te?q(""[Symbol.iterator]()):g,"%Symbol%":te?Symbol:g,"%SyntaxError%":ne,"%ThrowTypeError%":ho,"%TypedArray%":po,"%TypeError%":se,"%Uint8Array%":typeof Uint8Array>"u"?g:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?g:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?g:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?g:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?g:WeakMap,"%WeakRef%":typeof WeakRef>"u"?g:WeakRef,"%WeakSet%":typeof WeakSet>"u"?g:WeakSet};try{null.error}catch(s){ws=q(q(s)),Y["%Error.prototype%"]=ws}var ws,fo=function s(e){var t;if(e==="%AsyncFunction%")t=Et("async function () {}");else if(e==="%GeneratorFunction%")t=Et("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Et("async function* () {}");else if(e==="%AsyncGenerator%"){var r=s("%AsyncGeneratorFunction%");r&&(t=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=s("%AsyncGenerator%");n&&(t=q(n.prototype))}return Y[e]=t,t},_s={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},me=We(),Qe=z(),mo=me.call(Function.call,Array.prototype.concat),yo=me.call(Function.apply,Array.prototype.splice),bs=me.call(Function.call,String.prototype.replace),Ve=me.call(Function.call,String.prototype.slice),go=me.call(Function.call,RegExp.prototype.exec),vo=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Co=/\\(\\)?/g,wo=function(e){var t=Ve(e,0,1),r=Ve(e,-1);if(t==="%"&&r!=="%")throw new ne("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&t!=="%")throw new ne("invalid intrinsic syntax, expected opening `%`");var n=[];return bs(e,vo,function(i,u,o,p){n[n.length]=o?bs(p,Co,"$1"):u||i}),n},_o=function(e,t){var r=e,n;if(Qe(_s,r)&&(n=_s[r],r="%"+n[0]+"%"),Qe(Y,r)){var i=Y[r];if(i===re&&(i=fo(r)),typeof i>"u"&&!t)throw new se("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new ne("intrinsic "+e+" does not exist!")};As.exports=function(e,t){if(typeof e!="string"||e.length===0)throw new se("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new se('"allowMissing" argument must be a boolean');if(go(/^%?[^%]*%?$/,e)===null)throw new ne("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=wo(e),n=r.length>0?r[0]:"",i=_o("%"+n+"%",t),u=i.name,o=i.value,p=!1,a=i.alias;a&&(n=a[0],yo(r,mo([0,1],a)));for(var c=1,l=!0;c<r.length;c+=1){var h=r[c],d=Ve(h,0,1),y=Ve(h,-1);if((d==='"'||d==="'"||d==="`"||y==='"'||y==="'"||y==="`")&&d!==y)throw new ne("property names with quotes must have matching quotes");if((h==="constructor"||!l)&&(p=!0),n+="."+h,u="%"+n+"%",Qe(Y,u))o=Y[u];else if(o!=null){if(!(h in o)){if(!t)throw new se("base intrinsic for "+e+" exists, but the property is not available.");return}if(X&&c+1>=r.length){var m=X(o,h);l=!!m,l&&"get"in m&&!("originalValue"in m.get)?o=m.get:o=o[h]}else l=Qe(o,h),o=o[h];l&&!p&&(Y[u]=o)}}return o}});var Ft=f((tl,ze)=>{"use strict";var xt=We(),ae=U(),Ts=ae("%Function.prototype.apply%"),Es=ae("%Function.prototype.call%"),ks=ae("%Reflect.apply%",!0)||xt.call(Es,Ts),Ps=ae("%Object.getOwnPropertyDescriptor%",!0),Z=ae("%Object.defineProperty%",!0),bo=ae("%Math.max%");if(Z)try{Z({},"a",{value:1})}catch{Z=null}ze.exports=function(e){var t=ks(xt,Es,arguments);if(Ps&&Z){var r=Ps(t,"length");r.configurable&&Z(t,"length",{value:1+bo(0,e.length-(arguments.length-1))})}return t};var Ss=function(){return ks(xt,Ts,arguments)};Z?Z(ze.exports,"apply",{value:Ss}):ze.exports.apply=Ss});var Rt=f((rl,Fs)=>{"use strict";var xs=Object.prototype.toString;Fs.exports=function(e){var t=xs.call(e),r=t==="[object Arguments]";return r||(r=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&xs.call(e.callee)==="[object Function]"),r}});var qs=f((sl,Ds)=>{"use strict";var Bs;Object.keys||(ye=Object.prototype.hasOwnProperty,Ot=Object.prototype.toString,Rs=Rt(),Ut=Object.prototype.propertyIsEnumerable,Os=!Ut.call({toString:null},"toString"),Us=Ut.call(function(){},"prototype"),ge=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Je=function(s){var e=s.constructor;return e&&e.prototype===s},Ls={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Gs=function(){if(typeof window>"u")return!1;for(var s in window)try{if(!Ls["$"+s]&&ye.call(window,s)&&window[s]!==null&&typeof window[s]=="object")try{Je(window[s])}catch{return!0}}catch{return!0}return!1}(),Ms=function(s){if(typeof window>"u"||!Gs)return Je(s);try{return Je(s)}catch{return!1}},Bs=function(e){var t=e!==null&&typeof e=="object",r=Ot.call(e)==="[object Function]",n=Rs(e),i=t&&Ot.call(e)==="[object String]",u=[];if(!t&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var o=Us&&r;if(i&&e.length>0&&!ye.call(e,0))for(var p=0;p<e.length;++p)u.push(String(p));if(n&&e.length>0)for(var a=0;a<e.length;++a)u.push(String(a));else for(var c in e)!(o&&c==="prototype")&&ye.call(e,c)&&u.push(String(c));if(Os)for(var l=Ms(e),h=0;h<ge.length;++h)!(l&&ge[h]==="constructor")&&ye.call(e,ge[h])&&u.push(ge[h]);return u});var ye,Ot,Rs,Ut,Os,Us,ge,Je,Ls,Gs,Ms;Ds.exports=Bs});var Hs=f((nl,$s)=>{"use strict";var Io=Array.prototype.slice,Ao=Rt(),Ns=Object.keys,Ke=Ns?function(e){return Ns(e)}:qs(),js=Object.keys;Ke.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(r){return Ao(r)?js(Io.call(r)):js(r)})}else Object.keys=Ke;return Object.keys||Ke};$s.exports=Ke});var Mt=f((al,Ws)=>{"use strict";var Po=U(),Lt=Po("%Object.defineProperty%",!0),Gt=function(){if(Lt)try{return Lt({},"a",{value:1}),!0}catch{return!1}return!1};Gt.hasArrayLengthDefineBug=function(){if(!Gt())return null;try{return Lt([],"length",{value:1}).length!==1}catch{return!0}};Ws.exports=Gt});var Bt=f((il,Js)=>{"use strict";var So=Hs(),To=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Eo=Object.prototype.toString,ko=Array.prototype.concat,Qs=Object.defineProperty,xo=function(s){return typeof s=="function"&&Eo.call(s)==="[object Function]"},Fo=Mt()(),Vs=Qs&&Fo,Ro=function(s,e,t,r){if(e in s){if(r===!0){if(s[e]===t)return}else if(!xo(r)||!r())return}Vs?Qs(s,e,{configurable:!0,enumerable:!1,value:t,writable:!0}):s[e]=t},zs=function(s,e){var t=arguments.length>2?arguments[2]:{},r=So(e);To&&(r=ko.call(r,Object.getOwnPropertySymbols(e)));for(var n=0;n<r.length;n+=1)Ro(s,r[n],e[r[n]],t[r[n]])};zs.supportsDescriptors=!!Vs;Js.exports=zs});var Xe=f((ol,Ks)=>{"use strict";Ks.exports=function(){if(typeof Promise!="function")throw new TypeError("`Promise.prototype.finally` requires a global `Promise` be available.")}});var en=f((cl,Zs)=>{"use strict";var Ys=Function.prototype.toString,ie=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,qt,Ye;if(typeof ie=="function"&&typeof Object.defineProperty=="function")try{qt=Object.defineProperty({},"length",{get:function(){throw Ye}}),Ye={},ie(function(){throw 42},null,qt)}catch(s){s!==Ye&&(ie=null)}else ie=null;var Oo=/^\s*class\b/,Nt=function(e){try{var t=Ys.call(e);return Oo.test(t)}catch{return!1}},Dt=function(e){try{return Nt(e)?!1:(Ys.call(e),!0)}catch{return!1}},Ze=Object.prototype.toString,Uo="[object Object]",Lo="[object Function]",Go="[object GeneratorFunction]",Mo="[object HTMLAllCollection]",Bo="[object HTML document.all class]",Do="[object HTMLCollection]",qo=typeof Symbol=="function"&&!!Symbol.toStringTag,No=!(0 in[,]),jt=function(){return!1};typeof document=="object"&&(Xs=document.all,Ze.call(Xs)===Ze.call(document.all)&&(jt=function(e){if((No||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=Ze.call(e);return(t===Mo||t===Bo||t===Do||t===Uo)&&e("")==null}catch{}return!1}));var Xs;Zs.exports=ie?function(e){if(jt(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{ie(e,null,qt)}catch(t){if(t!==Ye)return!1}return!Nt(e)&&Dt(e)}:function(e){if(jt(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(qo)return Dt(e);if(Nt(e))return!1;var t=Ze.call(e);return t!==Lo&&t!==Go&&!/^\[object HTML/.test(t)?!1:Dt(e)}});var $t=f((ul,tn)=>{"use strict";tn.exports=en()});var sn=f((ll,rn)=>{"use strict";rn.exports=U()});var an=f((hl,nn)=>{"use strict";var jo=U(),$o=z(),Ho=jo("%TypeError%");nn.exports=function(e,t){if(e.Type(t)!=="Object")return!1;var r={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var n in t)if($o(t,n)&&!r[n])return!1;if(e.IsDataDescriptor(t)&&e.IsAccessorDescriptor(t))throw new Ho("Property Descriptors may not be both accessor and data descriptors");return!0}});var Ht=f((pl,un)=>{"use strict";var on=U(),cn=Ft(),Wo=cn(on("String.prototype.indexOf"));un.exports=function(e,t){var r=on(e,!!t);return typeof r=="function"&&Wo(e,".prototype.")>-1?cn(r):r}});var pn=f((dl,hn)=>{"use strict";var Qo=U(),ln=Qo("%Array%"),Vo=!ln.isArray&&Ht()("Object.prototype.toString");hn.exports=ln.isArray||function(e){return Vo(e)==="[object Array]"}});var gn=f((fl,yn)=>{"use strict";var fn=Mt(),zo=U(),dn=fn()&&zo("%Object.defineProperty%",!0),mn=fn.hasArrayLengthDefineBug(),Jo=mn&&pn(),Ko=Ht(),Xo=Ko("Object.prototype.propertyIsEnumerable");yn.exports=function(e,t,r,n,i,u){if(!dn){if(!e(u)||!u["[[Configurable]]"]||!u["[[Writable]]"]||i in n&&Xo(n,i)!==!!u["[[Enumerable]]"])return!1;var o=u["[[Value]]"];return n[i]=o,t(n[i],o)}return mn&&i==="length"&&"[[Value]]"in u&&Jo(n)&&n.length!==u["[[Value]]"]?(n.length=u["[[Value]]"],n.length===u["[[Value]]"]):(dn(n,i,r(u)),!0)}});var wn=f((ml,Cn)=>{"use strict";var vn=z();Cn.exports=function(e){return vn(e,"[[StartIndex]]")&&vn(e,"[[EndIndex]]")&&e["[[StartIndex]]"]>=0&&e["[[EndIndex]]"]>=e["[[StartIndex]]"]&&String(parseInt(e["[[StartIndex]]"],10))===String(e["[[StartIndex]]"])&&String(parseInt(e["[[EndIndex]]"],10))===String(e["[[EndIndex]]"])}});var et=f((yl,An)=>{"use strict";var _n=U(),bn=_n("%TypeError%"),Yo=_n("%SyntaxError%"),L=z(),Zo=wn(),In={"Property Descriptor":function(e){var t={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in e)if(L(e,r)&&!t[r])return!1;var n=L(e,"[[Value]]"),i=L(e,"[[Get]]")||L(e,"[[Set]]");if(n&&i)throw new bn("Property Descriptors may not be both accessor and data descriptors");return!0},"Match Record":Zo,"Iterator Record":function(e){return L(e,"[[Iterator]]")&&L(e,"[[NextMethod]]")&&L(e,"[[Done]]")},"PromiseCapability Record":function(e){return e&&L(e,"[[Resolve]]")&&typeof e["[[Resolve]]"]=="function"&&L(e,"[[Reject]]")&&typeof e["[[Reject]]"]=="function"&&L(e,"[[Promise]]")&&e["[[Promise]]"]&&typeof e["[[Promise]]"].then=="function"},"AsyncGeneratorRequest Record":function(e){return e&&L(e,"[[Completion]]")&&L(e,"[[Capability]]")&&In["PromiseCapability Record"](e["[[Capability]]"])}};An.exports=function(e,t,r,n){var i=In[t];if(typeof i!="function")throw new Yo("unknown record type: "+t);if(e(n)!=="Object"||!i(n))throw new bn(r+" must be a "+t)}});var Sn=f((gl,Pn)=>{"use strict";Pn.exports=function(e){if(typeof e>"u")return e;var t={};return"[[Value]]"in e&&(t.value=e["[[Value]]"]),"[[Writable]]"in e&&(t.writable=!!e["[[Writable]]"]),"[[Get]]"in e&&(t.get=e["[[Get]]"]),"[[Set]]"in e&&(t.set=e["[[Set]]"]),"[[Enumerable]]"in e&&(t.enumerable=!!e["[[Enumerable]]"]),"[[Configurable]]"in e&&(t.configurable=!!e["[[Configurable]]"]),t}});var En=f((vl,Tn)=>{"use strict";Tn.exports=function(e){if(e===null)return"Null";if(typeof e>"u")return"Undefined";if(typeof e=="function"||typeof e=="object")return"Object";if(typeof e=="number")return"Number";if(typeof e=="boolean")return"Boolean";if(typeof e=="string")return"String"}});var J=f((Cl,kn)=>{"use strict";var ec=En();kn.exports=function(e){return typeof e=="symbol"?"Symbol":typeof e=="bigint"?"BigInt":ec(e)}});var Fn=f((wl,xn)=>{"use strict";var tc=et(),rc=Sn(),sc=J();xn.exports=function(e){return typeof e<"u"&&tc(sc,"Property Descriptor","Desc",e),rc(e)}});var Un=f((_l,On)=>{"use strict";var Rn=z(),nc=et(),ac=J();On.exports=function(e){return!(typeof e>"u"||(nc(ac,"Property Descriptor","Desc",e),!Rn(e,"[[Get]]")&&!Rn(e,"[[Set]]")))}});var Mn=f((bl,Gn)=>{"use strict";var Ln=z(),ic=et(),oc=J();Gn.exports=function(e){return!(typeof e>"u"||(ic(oc,"Property Descriptor","Desc",e),!Ln(e,"[[Value]]")&&!Ln(e,"[[Writable]]")))}});var Dn=f((Il,Bn)=>{"use strict";Bn.exports=function(e){return typeof e=="string"||typeof e=="symbol"}});var Nn=f((Al,qn)=>{"use strict";qn.exports=Number.isNaN||function(e){return e!==e}});var Hn=f((Pl,$n)=>{"use strict";var jn=Nn();$n.exports=function(e,t){return e===t?e===0?1/e===1/t:!0:jn(e)&&jn(t)}});var Qn=f((Sl,Wn)=>{"use strict";Wn.exports=function(e){return!!e}});var Jn=f((Tl,zn)=>{"use strict";var N=z(),cc=U(),tt=cc("%TypeError%"),uc=J(),Wt=Qn(),Vn=$t();zn.exports=function(e){if(uc(e)!=="Object")throw new tt("ToPropertyDescriptor requires an object");var t={};if(N(e,"enumerable")&&(t["[[Enumerable]]"]=Wt(e.enumerable)),N(e,"configurable")&&(t["[[Configurable]]"]=Wt(e.configurable)),N(e,"value")&&(t["[[Value]]"]=e.value),N(e,"writable")&&(t["[[Writable]]"]=Wt(e.writable)),N(e,"get")){var r=e.get;if(typeof r<"u"&&!Vn(r))throw new tt("getter must be a function");t["[[Get]]"]=r}if(N(e,"set")){var n=e.set;if(typeof n<"u"&&!Vn(n))throw new tt("setter must be a function");t["[[Set]]"]=n}if((N(t,"[[Get]]")||N(t,"[[Set]]"))&&(N(t,"[[Value]]")||N(t,"[[Writable]]")))throw new tt("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}});var Zn=f((El,Yn)=>{"use strict";var lc=U(),Qt=lc("%TypeError%"),Kn=an(),hc=gn(),pc=Fn(),Xn=Un(),Vt=Mn(),dc=Dn(),fc=Hn(),mc=Jn(),zt=J();Yn.exports=function(e,t,r){if(zt(e)!=="Object")throw new Qt("Assertion failed: Type(O) is not Object");if(!dc(t))throw new Qt("Assertion failed: IsPropertyKey(P) is not true");var n=Kn({Type:zt,IsDataDescriptor:Vt,IsAccessorDescriptor:Xn},r)?r:mc(r);if(!Kn({Type:zt,IsDataDescriptor:Vt,IsAccessorDescriptor:Xn},n))throw new Qt("Assertion failed: Desc is not a valid Property Descriptor");return hc(Vt,fc,pc,e,t,n)}});var ta=f((kl,Xt)=>{"use strict";var yc=sn(),ea=yc("%Reflect.construct%",!0),rt=Zn();try{rt({},"",{"[[Get]]":function(){}})}catch{rt=null}rt&&ea?(Jt={},Kt={},rt(Kt,"length",{"[[Get]]":function(){throw Jt},"[[Enumerable]]":!0}),Xt.exports=function(e){try{ea(e,Kt)}catch(t){return t===Jt}}):Xt.exports=function(e){return typeof e=="function"&&!!e.prototype};var Jt,Kt});var ia=f((xl,aa)=>{"use strict";var na=U(),ra=na("%Symbol.species%",!0),Yt=na("%TypeError%"),gc=ta(),sa=J();aa.exports=function(e,t){if(sa(e)!=="Object")throw new Yt("Assertion failed: Type(O) is not Object");var r=e.constructor;if(typeof r>"u")return t;if(sa(r)!=="Object")throw new Yt("O.constructor is not an Object");var n=ra?r[ra]:void 0;if(n==null)return t;if(gc(n))return n;throw new Yt("no constructor found")}});var tr=f((Fl,ca)=>{"use strict";var vc=Xe();vc();var Cc=$t(),wc=ia(),_c=J(),oa=function(e,t){return new e(function(r){r(t)})},bc=Promise,Ic=function(e,t){return function(r){var n=t(),i=oa(e,n),u=function(){return r};return i.then(u)}},Ac=function(e,t){return function(r){var n=t(),i=oa(e,n),u=function(){throw r};return i.then(u)}},er=function(e){var t=this;if(_c(t)!=="Object")throw new TypeError("receiver is not an Object");var r=wc(t,bc),n=e,i=e;return Cc(e)&&(n=Ic(r,e),i=Ac(r,e)),t.then(n,i)};Object.getOwnPropertyDescriptor&&(Zt=Object.getOwnPropertyDescriptor(er,"name"),Zt&&Zt.configurable&&Object.defineProperty(er,"name",{configurable:!0,value:"finally"}));var Zt;ca.exports=er});var rr=f((Rl,ua)=>{"use strict";var Pc=Xe(),Sc=tr();ua.exports=function(){return Pc(),typeof Promise.prototype.finally=="function"?Promise.prototype.finally:Sc}});var ha=f((Ol,la)=>{"use strict";var Tc=Xe(),Ec=rr(),kc=Bt();la.exports=function(){Tc();var e=Ec();return kc(Promise.prototype,{finally:e},{finally:function(){return Promise.prototype.finally!==e}}),e}});var ma=f((Ul,fa)=>{"use strict";var xc=Ft(),Fc=Bt(),Rc=tr(),pa=rr(),Oc=ha(),da=xc(pa());Fc(da,{getPolyfill:pa,implementation:Rc,shim:Oc});fa.exports=da});var ga=f((Gl,ya)=>{var Uc=St(),Lc=ma();ya.exports=class{constructor(){this._items=new Map}create(e,t,r){return this._rejectExistingRequest(e),this._createNewRequest(e,t,r)}resolve(e,t){e&&this._items.has(e)&&this._items.get(e).resolve(t)}rejectAll(e){this._items.forEach(t=>t.isPending?t.reject(e):null)}_rejectExistingRequest(e){let t=this._items.get(e);t&&t.isPending&&t.reject(new Error(`WebSocket request is replaced, id: ${e}`))}_createNewRequest(e,t,r){let n=new Uc({timeout:r,timeoutReason:`WebSocket request was rejected by timeout (${r} ms). RequestId: ${e}`});return this._items.set(e,n),Lc(n.call(t),()=>this._deleteRequest(e,n))}_deleteRequest(e,t){this._items.get(e)===t&&this._items.delete(e)}}});var Ca=f((Ml,va)=>{va.exports={createWebSocket:s=>new WebSocket(s),packMessage:null,unpackMessage:null,attachRequestId:null,extractRequestId:null,extractMessageData:s=>s.data,timeout:0,connectionTimeout:0}});var wa=f(sr=>{sr.throwIf=(s,e)=>{if(s)throw new Error(e)};sr.isPromise=s=>s&&typeof s.then=="function"});var ar=f((Dl,Ia)=>{var K=rs(),_a=St(),{PromisedMap:Gc}=ls(),Mc=ga(),ba=Ca(),{throwIf:st,isPromise:Bc}=wa(),nt={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},nr=class{constructor(e,t){this._assertOptions(t),this._url=e,this._options=Object.assign({},ba,t),this._requests=new Mc,this._promisedMap=new Gc,this._ws=null,this._wsSubscription=null,this._createOpeningController(),this._createClosingController(),this._createChannels()}get ws(){return this._ws}get url(){return this._url}get isOpening(){return Boolean(this._ws&&this._ws.readyState===nt.CONNECTING)}get isOpened(){return Boolean(this._ws&&this._ws.readyState===nt.OPEN)}get isClosing(){return Boolean(this._ws&&this._ws.readyState===nt.CLOSING)}get isClosed(){return Boolean(!this._ws||this._ws.readyState===nt.CLOSED)}get onOpen(){return this._onOpen}get onSend(){return this._onSend}get onMessage(){return this._onMessage}get onUnpackedMessage(){return this._onUnpackedMessage}get onResponse(){return this._onResponse}get onClose(){return this._onClose}get onError(){return this._onError}open(){return this.isClosing?Promise.reject(new Error("Can't open WebSocket while closing.")):this.isOpened?this._opening.promise:this._opening.call(()=>{this._opening.promise.catch(e=>this._cleanup(e)),this._createWS()})}sendRequest(e,t={}){let r=t.requestId||`${Math.random()}`,n=t.timeout!==void 0?t.timeout:this._options.timeout;return this._requests.create(r,()=>{this._assertRequestIdHandlers();let i=this._options.attachRequestId(e,r);this.sendPacked(i)},n)}sendPacked(e){this._assertPackingHandlers();let t=this._options.packMessage(e);this.send(t)}send(e){st(!this.isOpened,"Can't send data because WebSocket is not opened."),this._ws.send(e),this._onSend.dispatchAsync(e)}waitUnpackedMessage(e,t={}){return st(typeof e!="function",`Predicate must be a function, got ${typeof e}`),t.timeout&&setTimeout(()=>{if(this._promisedMap.has(e)){let r=t.timeoutError||new Error("Timeout");this._promisedMap.reject(e,r)}},t.timeout),this._promisedMap.set(e)}close(e,t){return this.isClosed?Promise.resolve(this._closing.value):this._closing.call(()=>this._ws.close(e,t))}removeAllListeners(){this._onOpen.removeAllListeners(),this._onMessage.removeAllListeners(),this._onUnpackedMessage.removeAllListeners(),this._onResponse.removeAllListeners(),this._onSend.removeAllListeners(),this._onClose.removeAllListeners(),this._onError.removeAllListeners()}_createOpeningController(){let e=this._options.connectionTimeout||this._options.timeout;this._opening=new _a({timeout:e,timeoutReason:`Can't open WebSocket within allowed timeout: ${e} ms.`})}_createClosingController(){let e=this._options.timeout;this._closing=new _a({timeout:e,timeoutReason:`Can't close WebSocket within allowed timeout: ${e} ms.`})}_createChannels(){this._onOpen=new K,this._onMessage=new K,this._onUnpackedMessage=new K,this._onResponse=new K,this._onSend=new K,this._onClose=new K,this._onError=new K}_createWS(){this._ws=this._options.createWebSocket(this._url),this._wsSubscription=new K.Subscription([{channel:this._ws,event:"open",listener:e=>this._handleOpen(e)},{channel:this._ws,event:"message",listener:e=>this._handleMessage(e)},{channel:this._ws,event:"error",listener:e=>this._handleError(e)},{channel:this._ws,event:"close",listener:e=>this._handleClose(e)}]).on()}_handleOpen(e){this._onOpen.dispatchAsync(e),this._opening.resolve(e)}_handleMessage(e){let t=this._options.extractMessageData(e);this._onMessage.dispatchAsync(t),this._tryUnpack(t)}_tryUnpack(e){this._options.unpackMessage&&(e=this._options.unpackMessage(e),Bc(e)?e.then(t=>this._handleUnpackedData(t)):this._handleUnpackedData(e))}_handleUnpackedData(e){e!==void 0&&(this._onUnpackedMessage.dispatchAsync(e),this._tryHandleResponse(e)),this._tryHandleWaitingMessage(e)}_tryHandleResponse(e){if(this._options.extractRequestId){let t=this._options.extractRequestId(e);t&&(this._onResponse.dispatchAsync(e,t),this._requests.resolve(t,e))}}_tryHandleWaitingMessage(e){this._promisedMap.forEach((t,r)=>{let n=!1;try{n=r(e)}catch(i){this._promisedMap.reject(r,i);return}n&&this._promisedMap.resolve(r,e)})}_handleError(e){this._onError.dispatchAsync(e)}_handleClose(e){this._onClose.dispatchAsync(e),this._closing.resolve(e);let t=new Error(`WebSocket closed with reason: ${e.reason} (${e.code}).`);this._opening.isPending&&this._opening.reject(t),this._cleanup(t)}_cleanupWS(){this._wsSubscription&&(this._wsSubscription.off(),this._wsSubscription=null),this._ws=null}_cleanup(e){this._cleanupWS(),this._requests.rejectAll(e)}_assertOptions(e){Object.keys(e||{}).forEach(t=>{if(!ba.hasOwnProperty(t))throw new Error(`Unknown option: ${t}`)})}_assertPackingHandlers(){let{packMessage:e,unpackMessage:t}=this._options;st(!e||!t,"Please define 'options.packMessage / options.unpackMessage' for sending packed messages.")}_assertRequestIdHandlers(){let{attachRequestId:e,extractRequestId:t}=this._options;st(!e||!t,"Please define 'options.attachRequestId / options.extractRequestId' for sending requests.")}};Ia.exports=nr});var Sa=f((th,Pa)=>{(function(){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,r){return t<<r|t>>>32-r},rotr:function(t,r){return t<<32-r|t>>>r},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var r=0;r<t.length;r++)t[r]=e.endian(t[r]);return t},randomBytes:function(t){for(var r=[];t>0;t--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(t){for(var r=[],n=0,i=0;n<t.length;n++,i+=8)r[i>>>5]|=t[n]<<24-i%32;return r},wordsToBytes:function(t){for(var r=[],n=0;n<t.length*32;n+=8)r.push(t[n>>>5]>>>24-n%32&255);return r},bytesToHex:function(t){for(var r=[],n=0;n<t.length;n++)r.push((t[n]>>>4).toString(16)),r.push((t[n]&15).toString(16));return r.join("")},hexToBytes:function(t){for(var r=[],n=0;n<t.length;n+=2)r.push(parseInt(t.substr(n,2),16));return r},bytesToBase64:function(t){for(var r=[],n=0;n<t.length;n+=3)for(var i=t[n]<<16|t[n+1]<<8|t[n+2],u=0;u<4;u++)n*8+u*6<=t.length*8?r.push(s.charAt(i>>>6*(3-u)&63)):r.push("=");return r.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],n=0,i=0;n<t.length;i=++n%4)i!=0&&r.push((s.indexOf(t.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<i*2|s.indexOf(t.charAt(n))>>>6-i*2);return r}};Pa.exports=e})()});var or=f((rh,Ta)=>{var ir={utf8:{stringToBytes:function(s){return ir.bin.stringToBytes(unescape(encodeURIComponent(s)))},bytesToString:function(s){return decodeURIComponent(escape(ir.bin.bytesToString(s)))}},bin:{stringToBytes:function(s){for(var e=[],t=0;t<s.length;t++)e.push(s.charCodeAt(t)&255);return e},bytesToString:function(s){for(var e=[],t=0;t<s.length;t++)e.push(String.fromCharCode(s[t]));return e.join("")}}};Ta.exports=ir});var xa=f((sh,ka)=>{ka.exports=function(s){return s!=null&&(Ea(s)||Nc(s)||!!s._isBuffer)};function Ea(s){return!!s.constructor&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function Nc(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&Ea(s.slice(0,0))}});var Ra=f((nh,Fa)=>{(function(){var s=Sa(),e=or().utf8,t=xa(),r=or().bin,n=function(i,u){i.constructor==String?u&&u.encoding==="binary"?i=r.stringToBytes(i):i=e.stringToBytes(i):t(i)?i=Array.prototype.slice.call(i,0):!Array.isArray(i)&&i.constructor!==Uint8Array&&(i=i.toString());for(var o=s.bytesToWords(i),p=i.length*8,a=1732584193,c=-271733879,l=-1732584194,h=271733878,d=0;d<o.length;d++)o[d]=(o[d]<<8|o[d]>>>24)&16711935|(o[d]<<24|o[d]>>>8)&4278255360;o[p>>>5]|=128<<p%32,o[(p+64>>>9<<4)+14]=p;for(var y=n._ff,m=n._gg,A=n._hh,C=n._ii,d=0;d<o.length;d+=16){var $=a,hr=c,xe=l,Fe=h;a=y(a,c,l,h,o[d+0],7,-680876936),h=y(h,a,c,l,o[d+1],12,-389564586),l=y(l,h,a,c,o[d+2],17,606105819),c=y(c,l,h,a,o[d+3],22,-1044525330),a=y(a,c,l,h,o[d+4],7,-176418897),h=y(h,a,c,l,o[d+5],12,1200080426),l=y(l,h,a,c,o[d+6],17,-1473231341),c=y(c,l,h,a,o[d+7],22,-45705983),a=y(a,c,l,h,o[d+8],7,1770035416),h=y(h,a,c,l,o[d+9],12,-1958414417),l=y(l,h,a,c,o[d+10],17,-42063),c=y(c,l,h,a,o[d+11],22,-1990404162),a=y(a,c,l,h,o[d+12],7,1804603682),h=y(h,a,c,l,o[d+13],12,-40341101),l=y(l,h,a,c,o[d+14],17,-1502002290),c=y(c,l,h,a,o[d+15],22,1236535329),a=m(a,c,l,h,o[d+1],5,-165796510),h=m(h,a,c,l,o[d+6],9,-1069501632),l=m(l,h,a,c,o[d+11],14,643717713),c=m(c,l,h,a,o[d+0],20,-373897302),a=m(a,c,l,h,o[d+5],5,-701558691),h=m(h,a,c,l,o[d+10],9,38016083),l=m(l,h,a,c,o[d+15],14,-660478335),c=m(c,l,h,a,o[d+4],20,-405537848),a=m(a,c,l,h,o[d+9],5,568446438),h=m(h,a,c,l,o[d+14],9,-1019803690),l=m(l,h,a,c,o[d+3],14,-187363961),c=m(c,l,h,a,o[d+8],20,1163531501),a=m(a,c,l,h,o[d+13],5,-1444681467),h=m(h,a,c,l,o[d+2],9,-51403784),l=m(l,h,a,c,o[d+7],14,1735328473),c=m(c,l,h,a,o[d+12],20,-1926607734),a=A(a,c,l,h,o[d+5],4,-378558),h=A(h,a,c,l,o[d+8],11,-2022574463),l=A(l,h,a,c,o[d+11],16,1839030562),c=A(c,l,h,a,o[d+14],23,-35309556),a=A(a,c,l,h,o[d+1],4,-1530992060),h=A(h,a,c,l,o[d+4],11,1272893353),l=A(l,h,a,c,o[d+7],16,-155497632),c=A(c,l,h,a,o[d+10],23,-1094730640),a=A(a,c,l,h,o[d+13],4,681279174),h=A(h,a,c,l,o[d+0],11,-358537222),l=A(l,h,a,c,o[d+3],16,-722521979),c=A(c,l,h,a,o[d+6],23,76029189),a=A(a,c,l,h,o[d+9],4,-640364487),h=A(h,a,c,l,o[d+12],11,-421815835),l=A(l,h,a,c,o[d+15],16,530742520),c=A(c,l,h,a,o[d+2],23,-995338651),a=C(a,c,l,h,o[d+0],6,-198630844),h=C(h,a,c,l,o[d+7],10,1126891415),l=C(l,h,a,c,o[d+14],15,-1416354905),c=C(c,l,h,a,o[d+5],21,-57434055),a=C(a,c,l,h,o[d+12],6,1700485571),h=C(h,a,c,l,o[d+3],10,-1894986606),l=C(l,h,a,c,o[d+10],15,-1051523),c=C(c,l,h,a,o[d+1],21,-2054922799),a=C(a,c,l,h,o[d+8],6,1873313359),h=C(h,a,c,l,o[d+15],10,-30611744),l=C(l,h,a,c,o[d+6],15,-1560198380),c=C(c,l,h,a,o[d+13],21,1309151649),a=C(a,c,l,h,o[d+4],6,-145523070),h=C(h,a,c,l,o[d+11],10,-1120210379),l=C(l,h,a,c,o[d+2],15,718787259),c=C(c,l,h,a,o[d+9],21,-343485551),a=a+$>>>0,c=c+hr>>>0,l=l+xe>>>0,h=h+Fe>>>0}return s.endian([a,c,l,h])};n._ff=function(i,u,o,p,a,c,l){var h=i+(u&o|~u&p)+(a>>>0)+l;return(h<<c|h>>>32-c)+u},n._gg=function(i,u,o,p,a,c,l){var h=i+(u&p|o&~p)+(a>>>0)+l;return(h<<c|h>>>32-c)+u},n._hh=function(i,u,o,p,a,c,l){var h=i+(u^o^p)+(a>>>0)+l;return(h<<c|h>>>32-c)+u},n._ii=function(i,u,o,p,a,c,l){var h=i+(o^(u|~p))+(a>>>0)+l;return(h<<c|h>>>32-c)+u},n._blocksize=16,n._digestsize=16,Fa.exports=function(i,u){if(i==null)throw new Error("Illegal argument "+i);var o=s.wordsToBytes(n(i,u));return u&&u.asBytes?o:u&&u.asString?r.bytesToString(o):s.bytesToHex(o)}})()});var v=P(k());var b=P(k());var E=new B("ChatGPT/OpenAIChat"),le=class extends R{constructor(){super("OpenAIChat");this.status="needAuth";this.isAnswering=!1;this.sendQuestion=async(t,r,n,i)=>{if(!this.isAnswering){if(xr().then().catch(),this.questionSender=r,this.isAnswering=!0,(await D()).currentModel==="gpt-4-code-interpreter"){let o=this.chatFiles.find(p=>p.uploadStatus==="success");o&&o.uploadedUrl&&(i.meta||(i.meta={}),i.meta.attachments=[{name:o.fileName,url:o.uploadedUrl}],this.chatFiles=[],W("Client_listenUploadFilesChange",{files:this.chatFiles}))}await this.sendDaemonProcessTask("OpenAIDaemonProcess_askChatGPTQuestion",{taskId:t,question:n,options:i})}};this.init()}init(){Q(async(t,r,n,i)=>{var u,o,p;if(t==="daemon_process")switch(r){case"OpenAIDaemonProcess_daemonProcessExist":{if(!this.active)break;let a=this.chatGPTProxyInstance&&await Ge(this.chatGPTProxyInstance)||!1;return a&&((u=i.tab)==null?void 0:u.id)&&(a=i.tab.id!==((o=this.chatGPTProxyInstance)==null?void 0:o.id),E.info("OpenAIDaemonProcess_daemonProcessExist","\u662F\u5426\u540C\u4E00\u4E2Atab",i.tab.id===((p=this.chatGPTProxyInstance)==null?void 0:p.id))),E.info("OpenAIDaemonProcess_daemonProcessExist",a),{success:!0,message:"",data:{isExist:a}}}case"OpenAIDaemonProcess_setDaemonProcess":{if(!this.active)break;return E.info("OpenAIDaemonProcess_setDaemonProcess"),this.chatGPTProxyInstance=i.tab,this.status="success",await this.updateClientStatus(),this.listenDaemonProcessTab(),this.lastActiveTabId&&this.lastActiveTabId>0&&(await b.default.tabs.update(this.lastActiveTabId,{active:!0}),this.lastActiveTabId=void 0),{success:!0,message:"",data:{}}}break;case"OpenAIDaemonProcess_taskResponse":{if(!this.active)break;E.info("OpenAIDaemonProcess_taskResponse",n);let{taskId:a,data:c,done:l,error:h}=n;if(this.questionSender&&n){let{tab:d}=this.questionSender;d&&d.id&&(this.currentTaskId=a,await b.default.tabs.sendMessage(d.id,{id:w,event:"Client_askChatGPTQuestionResponse",data:{taskId:a,data:c,done:l,error:h}}),l&&(this.isAnswering=!1,this.currentTaskId=void 0))}}break;case"OpenAIDaemonProcess_daemonProcessSessionExpired":{return E.info("OpenAIDaemonProcess_daemonProcessSessionExpired"),this.status="needAuth",await this.updateClientStatus(),{success:!0,message:"",data:{}};break}case"OpenAIDaemonProcess_pong":return E.info("DaemonProcess_pong",this.chatGPTProxyInstance),{success:!0,message:"",data:{}};default:break}})}async preAuth(){var t;if(this.active=!0,this.status!=="needAuth"&&this.cacheLastTimeChatGPTProxyInstance&&this.cacheLastTimeChatGPTProxyInstance.id){let r=await b.default.tabs.get(this.cacheLastTimeChatGPTProxyInstance.id);if(r&&r.id&&((t=r==null?void 0:r.url)==null?void 0:t.startsWith("https://chat.openai.com"))){let n=await b.default.tabs.sendMessage(r.id,{id:w,event:"OpenAIDaemonProcess_ping"});n&&n.success?(this.chatGPTProxyInstance=r,this.status="success"):(this.cacheLastTimeChatGPTProxyInstance=void 0,this.status="needAuth")}}else this.status="needAuth";await this.updateClientStatus()}async auth(t){if(this.lastActiveTabId=t,this.active=!0,this.status="loading",await this.updateClientStatus(),!this.chatGPTProxyInstance)if(this.cacheLastTimeChatGPTProxyInstance&&this.cacheLastTimeChatGPTProxyInstance.id){let r=await b.default.tabs.get(this.cacheLastTimeChatGPTProxyInstance.id);this.chatGPTProxyInstance=r||await ue()}else this.chatGPTProxyInstance=await ue();if(this.chatGPTProxyInstance){let r=this.chatGPTProxyInstance.windowId;if(r)try{await b.default.windows.update(r,{focused:!0})}catch(n){}await b.default.tabs.update(this.chatGPTProxyInstance.id,{active:!0}),await b.default.tabs.reload(this.chatGPTProxyInstance.id),this.status="complete",this.listenDaemonProcessTab(),await this.updateClientStatus(),this.keepAlive()}}async createConversation(){let t=await D(),r=await this.sendDaemonProcessTask("OpenAIDaemonProcess_createConversation",{conversationId:t.conversationId||"",model:t.currentModel||""});return E.info("createConversation",r),r.success?r.data.conversationId:""}async removeConversation(t){return t?(E.info("removeConversation",t),(await this.sendDaemonProcessTask("OpenAIDaemonProcess_removeConversation",{conversationId:t})).success):!0}async abortAskQuestion(t){return(await this.sendDaemonProcessTask("OpenAIDaemonProcess_abortAskChatGPTQuestion",{messageId:t})).success}async destroy(){E.info("destroy"),this.clearFiles(),this.chatGPTProxyInstance&&this.chatGPTProxyInstance.id&&(this.cacheLastTimeChatGPTProxyInstance=this.chatGPTProxyInstance),this.active=!1}async sendDaemonProcessTask(t,r){if(this.chatGPTProxyInstance&&await Ge(this.chatGPTProxyInstance)&&this.chatGPTProxyInstance.id){let n=await b.default.tabs.sendMessage(this.chatGPTProxyInstance.id,{id:w,event:t,data:r});return E.info("sendDaemonProcessTask",n),n}return await this.destroy(),{success:!1,data:{},message:"daemon process not exist"}}async updateClientStatus(){this.active&&await W("Client_ChatGPTStatusUpdate",{status:this.status})}async keepAlive(){this.chatGPTProxyInstance&&await Ge(this.chatGPTProxyInstance)&&this.chatGPTProxyInstance.id&&(E.info("keepAliveDaemonProcess"),b.default.tabs.sendMessage(this.chatGPTProxyInstance.id,{id:w,event:"OpenAIDaemonProcess_ping"})),await(r=>new Promise(n=>setTimeout(n,r)))(20*1e3),this.active&&await this.keepAlive()}async tabRemoveListener(t){var r;if(((r=this.chatGPTProxyInstance)==null?void 0:r.id)&&t===this.chatGPTProxyInstance.id){if(E.info("\u5B88\u62A4\u8FDB\u7A0B\u5173\u95ED"),this.questionSender&&this.isAnswering){let{tab:n}=this.questionSender;n&&n.id&&this.currentTaskId&&await b.default.tabs.sendMessage(n.id,{id:w,event:"Client_askChatGPTQuestionResponse",data:{taskId:this.currentTaskId,data:null,done:!0,error:"manual aborted request."}})}this.chatGPTProxyInstance=void 0,this.cacheLastTimeChatGPTProxyInstance=void 0,this.status="needAuth",await this.updateClientStatus()}}async tabUpdateListener(t,r){var n,i,u;if(t===((n=this.chatGPTProxyInstance)==null?void 0:n.id)){let o=!((i=r.url)!=null&&i.includes("https://chat.openai.com")),p=(u=r.url)==null?void 0:u.includes("https://chat.openai.com/auth");r.url&&(o||p)&&(E.info("\u5B88\u62A4\u8FDB\u7A0Burl\u53D1\u751F\u53D8\u5316\uFF0C\u5B88\u62A4\u8FDB\u7A0B\u5173\u95ED"),this.cacheLastTimeChatGPTProxyInstance=this.chatGPTProxyInstance,this.chatGPTProxyInstance=void 0,this.status="needAuth",await this.updateClientStatus()),this.active?(r.status==="loading"||r.status==="complete")&&(E.info("\u5B88\u62A4\u8FDB\u7A0Burl\u72B6\u6001\u66F4\u65B0",r.status),this.status=r.status,await this.updateClientStatus(),await this.pingAwaitSuccess()):(this.cacheLastTimeChatGPTProxyInstance=this.chatGPTProxyInstance,this.chatGPTProxyInstance=void 0,this.status="needAuth",await this.updateClientStatus())}}async pingAwaitSuccess(){var r;let t=n=>new Promise(i=>setTimeout(i,n));if(((r=this.chatGPTProxyInstance)==null?void 0:r.id)&&this.active){E.info("start ping await success");let n=!1;for(let i=0;i<20&&!n;i++)b.default.tabs.sendMessage(this.chatGPTProxyInstance.id,{id:w,event:"OpenAIDaemonProcess_ping"}).then(u=>{u&&u.success&&(E.info("ping await success"),this.status="success",this.updateClientStatus(),n=!0)}),await t(1e3)}}listenDaemonProcessTab(){b.default.tabs.onRemoved.addListener(this.tabRemoveListener.bind(this)),b.default.tabs.onUpdated.addListener(this.tabUpdateListener.bind(this))}removeListener(){b.default.tabs.onRemoved.removeListener(this.tabRemoveListener.bind(this)),b.default.tabs.onUpdated.removeListener(this.tabUpdateListener.bind(this))}async minimizedDaemonProcessWindow(){var t;(t=this.chatGPTProxyInstance)!=null&&t.windowId&&await b.default.windows.update(this.chatGPTProxyInstance.windowId,{state:"minimized"})}async uploadFiles(t){var r,n;if(this.chatFiles=t,t.filter(i=>i.uploadStatus!=="success").length>0){if(!(await this.sendDaemonProcessTask("OpenAIDaemonProcess_pingFilesUpload",{})).success){this.chatFiles=this.chatFiles.map(o=>(o.uploadStatus="error",o.uploadErrorMessage="Your previous upload didn't go through as the Code Interpreter was initializing. It's now ready for your file. Please try uploading it again.",o));let u=(r=this.chatGPTProxyInstance)==null?void 0:r.id;u&&((n=(await D()).models)!=null&&n.find(p=>p.slug==="gpt-4-code-interpreter")?b.default.tabs.get(u).then(p=>{p&&b.default.tabs.update(p.id,{url:"https://chat.openai.com/?model=gpt-4-code-interpreter"})}):b.default.tabs.get(u).then(p=>{p&&b.default.tabs.update(p.id,{url:"https://chat.openai.com/?model=gpt-4"})}));return}this.chatFiles=this.chatFiles.map(u=>(u.uploadStatus="uploading",u)),await this.sendDaemonProcessTask("OpenAIDaemonProcess_filesUpload",{files:t})}}};var gt=P(k());var O=new B("Background/Chat/UseChatGPTPlusChat"),he=class extends R{constructor(){super("UseChatGPTPlusChat");this.status="needAuth";this.init()}init(){O.info("init")}async preAuth(){this.active=!0,await this.checkTokenAndUpdateStatus()}async auth(t){this.active=!0,this.lastActiveTabId=t,await this.checkTokenAndUpdateStatus(),this.status==="needAuth"&&await gt.default.tabs.create({active:!0,url:vr}),await this.updateClientStatus()}async checkTokenAndUpdateStatus(){let t=this.status;this.token=await this.getToken(),this.status=this.token?"success":"needAuth",t!==this.status&&(O.info("checkTokenAndUpdateStatus",this.status,this.lastActiveTabId),this.lastActiveTabId=void 0),await this.updateClientStatus()}async askChatGPT(t,r,n){if(await this.checkTokenAndUpdateStatus(),this.status!=="success"){n&&n({type:"error",done:!0,error:"Your session has expired. Please log in.",data:{text:"",conversationId:""}});return}let i=await Ir(),{include_history:u=!1,taskId:o,streaming:p=!0,regenerate:a=!1,max_history_message_cnt:c=0}=r||{},l=Object.assign({include_history:u,regenerate:a,streaming:p,message_content:t,max_history_message_cnt:c,chrome_extension_version:ee},i?{conversation_id:i}:{}),h=new AbortController,d=h.signal;o&&(this.taskList[o]=()=>h.abort()),O.info("streaming start",l);let y="",m=!1,A=!1,C=0,$=i,xe=(await gt.default.storage.local.get(pt))[pt]||{},Fe=xe.interval||50,pr=xe.rate||.5,ai=T=>new Promise(I=>setTimeout(I,T)),dr=async()=>{if(A)return;if(m&&C===y.length){O.info("streaming end success"),n&&n({done:!0,type:"message",error:"",data:{text:"",conversationId:$}});return}let T=0,I=Math.floor(y.length-C);if(m){let lt=Math.max(Math.floor(y.length*.1),10);T=y.slice(C,lt+C).length}else{let lt=Math.floor(I*pr);T=y.slice(C,lt+C).length}T>0&&(O.debug("streaming echo message",m?"\u4E00\u79D2\u53D1\u9001\u5B8C\u5269\u4E0B\u7684\u6587\u672C":`\u6BCF${Fe}\u6BEB\u79D2\u53D1\u9001\u5269\u4F59\u6587\u672C\u7684${(pr*100).toFixed(0)}%`,C,T,y.length),C+=T,n&&n({type:"message",done:!1,error:"",data:{text:y.slice(0,C),conversationId:$}})),await ai(m?100:Fe),await dr()};dr();let fr=!1;await Ue(`${gr}/gpt/get_chatgpt_response`,{provider:M.USE_CHAT_GPT_PLUS,method:"POST",signal:d,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(l),onMessage:T=>{try{let I=JSON.parse(T);I!=null&&I.conversation_id&&($=I.conversation_id),I!=null&&I.text&&(y+=I.text),O.debug("streaming on message",y)}catch(I){O.error("parse message.data error: 	",I)}}}).then().catch(T=>{if(O.info("streaming end error",T),m=!0,A=!0,(T==null?void 0:T.message)==="The user aborted a request."){n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:$}});return}try{let I=JSON.parse(T.message||T);(I==null?void 0:I.code)===401&&(fr=!0),O.error("sse error",T),n&&n({done:!0,type:"error",error:I.message||I.detail||"Network error.",data:{text:"",conversationId:$}})}catch(I){n&&n({done:!0,type:"error",error:"Network error.",data:{text:"",conversationId:$}})}}),m||(O.info("streaming end success"),m=!0),fr&&(O.info("user token expired"),this.status="needAuth",await Be(),await this.updateClientStatus())}async abortTask(t){return this.taskList[t]&&(this.taskList[t](),delete this.taskList[t]),!0}async destroy(){O.info("destroy"),this.status="needAuth",this.active=!1}async getToken(){return await Ne()}async updateClientStatus(){this.active&&await W("Client_ChatGPTStatusUpdate",{status:this.status})}};var ii=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,oi=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,ci=/^\s*["[{]|^\s*-?\d[\d.]{0,14}\s*$/;function ui(s,e){if(s!=="__proto__"&&!(s==="constructor"&&e&&typeof e=="object"&&"prototype"in e))return e}function Ur(s,e={}){if(typeof s!="string")return s;let t=s.toLowerCase().trim();if(t==="true")return!0;if(t==="false")return!1;if(t==="null")return null;if(t==="nan")return Number.NaN;if(t==="infinity")return Number.POSITIVE_INFINITY;if(t!=="undefined"){if(!ci.test(s)){if(e.strict)throw new SyntaxError("Invalid JSON");return s}try{return ii.test(s)||oi.test(s)?JSON.parse(s,ui):JSON.parse(s)}catch(r){if(e.strict)throw r;return s}}}var Iu=String.fromCharCode;var li=/#/g,hi=/&/g;var pi=/=/g;var Gr=/\+/g,di=/%5e/gi,fi=/%60/gi;var mi=/%7c/gi;var yi=/%20/gi;function gi(s){return encodeURI(""+s).replace(mi,"|")}function Ct(s){return gi(typeof s=="string"?s:JSON.stringify(s)).replace(Gr,"%2B").replace(yi,"+").replace(li,"%23").replace(hi,"%26").replace(fi,"`").replace(di,"^")}function vt(s){return Ct(s).replace(pi,"%3D")}function Mr(s=""){try{return decodeURIComponent(""+s)}catch{return""+s}}function vi(s){return Mr(s.replace(Gr," "))}function Ci(s=""){let e={};s[0]==="?"&&(s=s.slice(1));for(let t of s.split("&")){let r=t.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;let n=Mr(r[1]);if(n==="__proto__"||n==="constructor")continue;let i=vi(r[2]||"");typeof e[n]<"u"?Array.isArray(e[n])?e[n].push(i):e[n]=[e[n],i]:e[n]=i}return e}function wi(s,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(t=>`${vt(s)}=${Ct(t)}`).join("&"):`${vt(s)}=${Ct(e)}`:vt(s)}function _i(s){return Object.keys(s).filter(e=>s[e]!==void 0).map(e=>wi(e,s[e])).join("&")}var bi=/^\w{2,}:([/\\]{1,2})/,Ii=/^\w{2,}:([/\\]{2})?/,Ai=/^([/\\]\s*){2,}[^/\\]/;function Br(s,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?bi.test(s):Ii.test(s)||(e.acceptRelative?Ai.test(s):!1)}var Pi=/\/$|\/\?/;function wt(s="",e=!1){return e?Pi.test(s):s.endsWith("/")}function Si(s="",e=!1){if(!e)return(wt(s)?s.slice(0,-1):s)||"/";if(!wt(s,!0))return s||"/";let[t,...r]=s.split("?");return(t.slice(0,-1)||"/")+(r.length>0?`?${r.join("?")}`:"")}function Ti(s="",e=!1){if(!e)return s.endsWith("/")?s:s+"/";if(wt(s,!0))return s||"/";let[t,...r]=s.split("?");return t+"/"+(r.length>0?`?${r.join("?")}`:"")}function Ei(s=""){return s.startsWith("/")}function ki(s=""){return(Ei(s)?s.slice(1):s)||"/"}function Dr(s,e){if(xi(e)||Br(s))return s;let t=Si(e);return s.startsWith(t)?s:Ri(t,s)}function qr(s,e){let t=Nr(s),r={...Ci(t.search),...e};return t.search=_i(r),Oi(t)}function xi(s){return!s||s==="/"}function Fi(s){return s&&s!=="/"}function Ri(s,...e){let t=s||"";for(let r of e.filter(n=>Fi(n)))t=t?Ti(t)+ki(r):r;return t}function Nr(s="",e){if(!Br(s,{acceptRelative:!0}))return e?Nr(e+s):Lr(s);let[t="",r,n=""]=(s.replace(/\\/g,"/").match(/([^/:]+:)?\/\/([^/@]+@)?(.*)/)||[]).splice(1),[i="",u=""]=(n.match(/([^#/?]*)(.*)?/)||[]).splice(1),{pathname:o,search:p,hash:a}=Lr(u.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:t,auth:r?r.slice(0,Math.max(0,r.length-1)):"",host:i,pathname:o,search:p,hash:a}}function Lr(s=""){let[e="",t="",r=""]=(s.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:t,hash:r}}function Oi(s){let e=s.pathname+(s.search?(s.search.startsWith("?")?"":"?")+s.search:"")+s.hash;return s.protocol?s.protocol+"//"+(s.auth?s.auth+"@":"")+s.host+e:e}var _t=class extends Error{constructor(){super(...arguments),this.name="FetchError"}};function Ui(s,e,t){let r="";e&&(r=e.message),s&&t?r=`${r} (${t.status} ${t.statusText} (${s.toString()}))`:s&&(r=`${r} (${s.toString()})`);let n=new _t(r);return Object.defineProperty(n,"request",{get(){return s}}),Object.defineProperty(n,"response",{get(){return t}}),Object.defineProperty(n,"data",{get(){return t&&t._data}}),Object.defineProperty(n,"status",{get(){return t&&t.status}}),Object.defineProperty(n,"statusText",{get(){return t&&t.statusText}}),Object.defineProperty(n,"statusCode",{get(){return t&&t.status}}),Object.defineProperty(n,"statusMessage",{get(){return t&&t.statusText}}),n}var Li=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function jr(s="GET"){return Li.has(s.toUpperCase())}function Gi(s){if(s===void 0)return!1;let e=typeof s;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(s)?!0:s.constructor&&s.constructor.name==="Object"||typeof s.toJSON=="function"}var Mi=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Bi=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Di(s=""){if(!s)return"json";let e=s.split(";").shift()||"";return Bi.test(e)?"json":Mi.has(e)||e.startsWith("text/")?"text":"blob"}var qi=new Set([408,409,425,429,500,502,503,504]);function bt(s){let{fetch:e,Headers:t}=s;function r(u){let o=u.error&&u.error.name==="AbortError"||!1;if(u.options.retry!==!1&&!o){let a;typeof u.options.retry=="number"?a=u.options.retry:a=jr(u.options.method)?0:1;let c=u.response&&u.response.status||500;if(a>0&&qi.has(c))return n(u.request,{...u.options,retry:a-1})}let p=Ui(u.request,u.error,u.response);throw Error.captureStackTrace&&Error.captureStackTrace(p,n),p}let n=async function(o,p={}){let a={request:o,options:{...s.defaults,...p},response:void 0,error:void 0};a.options.onRequest&&await a.options.onRequest(a),typeof a.request=="string"&&(a.options.baseURL&&(a.request=Dr(a.request,a.options.baseURL)),(a.options.query||a.options.params)&&(a.request=qr(a.request,{...a.options.params,...a.options.query})),a.options.body&&jr(a.options.method)&&Gi(a.options.body)&&(a.options.body=typeof a.options.body=="string"?a.options.body:JSON.stringify(a.options.body),a.options.headers=new t(a.options.headers),a.options.headers.has("content-type")||a.options.headers.set("content-type","application/json"),a.options.headers.has("accept")||a.options.headers.set("accept","application/json"))),a.response=await e(a.request,a.options).catch(async l=>(a.error=l,a.options.onRequestError&&await a.options.onRequestError(a),r(a)));let c=(a.options.parseResponse?"json":a.options.responseType)||Di(a.response.headers.get("content-type")||"");if(c==="json"){let l=await a.response.text(),h=a.options.parseResponse||Ur;a.response._data=h(l)}else c==="stream"?a.response._data=a.response.body:a.response._data=await a.response[c]();return a.options.onResponse&&await a.options.onResponse(a),a.response.status>=400&&a.response.status<600?(a.options.onResponseError&&await a.options.onResponseError(a),r(a)):a.response},i=function(o,p){return n(o,p).then(a=>a._data)};return i.raw=n,i.native=e,i.create=(u={})=>bt({...s,defaults:{...s.defaults,...u}}),i}var $r=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),Ni=$r.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),ji=$r.Headers,F=bt({fetch:Ni,Headers:ji});function Hr(s,e){let r=new RegExp(`"${s}":"([^"]+)"`).exec(e);return r==null?void 0:r[1]}var Wr=async()=>{let s=await F("https://bard.google.com/faq",{cache:"reload"}),e=Hr("SNlM0e",s),t=Hr("cfb2h",s);return{atValue:e,blValue:t}},Qr=s=>{let e=JSON.parse(s.split(`
`)[3]),t=JSON.parse(e[0][2]);return t?{text:t[4][0][1][0],ids:[...t[1],t[4][0][0]]}:{text:`Failed to access Bard
Try again, or visit [bard.google.com](https://bard.google.com) for more information.`,ids:["","",""]}};var Vr=P(k());function $i(){return Math.floor(Math.random()*9e5)+1e5}var pe=class extends R{constructor(){super("BardChat");this.contextIds=["","",""];this.token=void 0,this.init()}async init(){let t=await j();t&&(this.status=t.ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_BARD?"success":"needAuth")}async checkAuth(){this.active=!0,this.token?await this.updateClientStatus("success"):await this.updateClientStatus("needAuth")}async auth(){this.active=!0,await this.syncBardToken()?await this.updateClientStatus("success"):(await this.updateClientStatus("needAuth"),await Vr.default.tabs.create({url:"https://bard.google.com/",active:!0}))}async askChatGPT(t,r,n){var a;this.conversationId||(this.conversationId=_());let{taskId:i}=r||{};if(!this.token){let c=await this.syncBardToken();this.status="needAuth",await this.updateClientStatus(this.status);return}let u=new AbortController,o=u.signal,p=!1;i&&(this.taskList[i]=()=>u.abort());try{let c=(a=this.chatFiles)==null?void 0:a[0],l=[null,JSON.stringify([[JSON.stringify(t),0,null,c!=null&&c.uploadedUrl?[[[c.uploadedUrl,1],c.fileName]]:[]],null,this.contextIds])],h=await F("https://bard.google.com/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",{method:"POST",signal:o,query:{bl:this.token.blValue,_reqid:$i(),rt:"c"},body:new URLSearchParams({at:this.token.atValue,"f.req":JSON.stringify(l)}),parseResponse:m=>m}).catch(m=>{if(m!=null&&m.message.includes("The user aborted a request.")){p=!0,n&&n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:""}});return}}).finally(()=>{this.clearFiles()}),{text:d,ids:y}=Qr(h);if(this.log.debug("result",h,d,y),d&&y){if(p)return;n&&n({type:"message",done:!1,error:"",data:{text:d,conversationId:this.conversationId}}),n&&n({type:"message",done:!0,error:"",data:{text:d,conversationId:this.conversationId}}),this.contextIds=y}else n&&n({type:"error",done:!0,error:"BardChat: Unknown Error",data:{text:"",conversationId:this.conversationId}})}catch(c){this.log.error(c)}}async syncBardToken(){let{atValue:t,blValue:r}=await Wr();return!t||!r?(this.token=void 0,!1):(this.token={atValue:t,blValue:r},!0)}reset(){this.conversationId="",this.contextIds=["","",""]}async uploadFiles(t){this.chatFiles=t,this.chatFiles=await Promise.all(t.map(async r=>{if(r.uploadStatus!=="success"){let[n,i]=qe(r.file),u=new Blob([n],{type:i}),o={"content-type":"application/x-www-form-urlencoded;charset=UTF-8","push-id":"feeds/mcudyrk2a4khkz","x-goog-upload-header-content-length":r.fileSize.toString(),"x-goog-upload-protocol":"resumable","x-tenant-id":"bard-storage"},a=(await F.raw("https://content-push.googleapis.com/upload/",{method:"POST",headers:{...o,"x-goog-upload-command":"start"},body:new URLSearchParams({[`File name: ${r.fileName}`]:""})})).headers.get("x-goog-upload-url");if(this.log.debug("Bard upload url",a),!a)return r.uploadErrorMessage="Failed to get upload url",r.uploadStatus="error",r;let c=await F.raw(a,{method:"POST",headers:{...o,"x-goog-upload-command":"upload, finalize","x-goog-upload-offset":"0"},body:u});return this.log.debug("Bard upload result",c==null?void 0:c._data),c.status===200?(r.uploadedUrl=c._data,r.uploadStatus="success"):(r.uploadErrorMessage="Failed to upload file",r.uploadStatus="error"),r}return r}))}async destroy(){await this.clearFiles(),await this.updateClientStatus("needAuth"),this.active=!1}};function Hi(){return`13.${Le(104,107)}.${Le(0,255)}.${Le(0,255)}`}var zr="https://www.bing.com/turing/conversation/create";async function Jr(){let s={"x-ms-client-request-id":_(),"x-ms-useragent":"azsdk-js-api-client-factory/1.0.0-beta.1 core-rest-pipeline/1.10.0 OS/Win32"},e;try{if(e=await F(zr,{headers:s,redirect:"error"}),!e.result)throw new Error("Invalid response")}catch(t){if(e=await F(zr,{headers:{...s,"x-forwarded-for":Hi()},redirect:"error"}),!e)throw new Error("Please sign in to [bing.com](http://bing.com/), complete any required verifications, then try again.")}if(e.result.value!=="Success"){let t=`${e.result.value}: ${e.result.message}

Please sign in to [bing.com](http://bing.com/), complete any required verifications, then try again.`;throw e.result.value==="UnauthorizedRequest"&&(t+=`
[Log into bing.com to continue.](https://www.bing.com/)`),e.result.value==="Forbidden"&&(t+=`
[Log into bing.com to continue.](https://www.bing.com/)`),new Error(t)}return e}var Aa=P(ar());var Dc={["balanced"]:"",["creative"]:"h3imaginative",["precise"]:"h3precise"},qc=["nlu_direct_response_filter","deepleo","disable_emoji_spoken_text","responsible_ai_policy_235","enablemm","iycapbing","iyxapbing","objopinion","rweasgv2","dagslnv1","dv3sugg","autosave","iyoloxap","iyoloneutral","clgalileo","gencontentv3"],at=class{buildChatRequest(e,t,r){let n=Dc[e.conversationStyle],i=qc.concat(n||[]);return{arguments:[{source:"cib",optionsSets:i,allowedMessageTypes:["Chat","InternalSearchQuery","Disengaged","InternalLoaderMessage","SemanticSerp","GenerateContentQuery","SearchQuery"],sliceIds:["winmuid1tf","anssupfor_c","imgchatgptv2","tts2cf","contansperf","mlchatpc8500w","mlchatpc2","ctrlworkpay","winshortmsgtf","cibctrl","sydtransctrl","sydconfigoptc","0705trt4","517opinion","628ajcopus0","330uaugs0","529rwea","0626snptrcs0","424dagslnv1"],isStartOfSession:e.invocationId===0,message:{author:"user",inputMethod:"Keyboard",text:t,imageUrl:r,messageType:"Chat"},conversationId:e.conversationId,conversationSignature:e.conversationSignature,participant:{id:e.clientId}}],invocationId:e.invocationId.toString(),target:"chat",type:4}}async doSendMessage(e){var n;if(!this.conversationContext)try{let i=await Jr(),u=await Pr("BING");this.conversationContext={conversationId:i.conversationId,conversationSignature:i.conversationSignature,clientId:i.clientId,invocationId:0,conversationStyle:(u==null?void 0:u.conversationStyle)||"balanced"}}catch(i){e.onEvent({type:"ERROR",error:i.message||i});return}let t=this.conversationContext,r=new Aa.default("wss://sydney.bing.com/sydney/ChatHub",{packMessage:mt.packMessage,unpackMessage:mt.unpackMessage});r.onUnpackedMessage.addListener(i=>{var u,o,p,a,c;for(let l of i)if(JSON.stringify(l)==="{}")r.sendPacked({type:6}),r.sendPacked(this.buildChatRequest(t,e.prompt,e.imageUrl)),t.invocationId+=1;else if(l.type===6)r.sendPacked({type:6});else if(l.type===3)e.onEvent({type:"DONE",data:{conversationId:t.conversationId}}),r.removeAllListeners(),r.close();else if(l.type===1){let h=(o=(u=l.arguments[0])==null?void 0:u.messages)==null?void 0:o[0],d=h?Fr(h):"";d&&e.onEvent({type:"UPDATE_ANSWER",data:{text:d,conversationId:t.conversationId}})}else if(l.type===2){let h=((p=l==null?void 0:l.item)==null?void 0:p.messages)||[],d=(c=(a=l==null?void 0:l.item)==null?void 0:a.result)==null?void 0:c.error;h.some(m=>m.contentOrigin==="TurnLimiter")&&e.onEvent({type:"ERROR",error:"Sorry, you have reached chat turns limit in this conversation."}),d==="User needs to solve CAPTCHA to continue."&&e.onEvent({type:"ERROR",error:d+`

Please sign in to [bing.com](http://bing.com/), complete any required verifications, then try again.`})}}),r.onClose.addListener(()=>{e.onEvent({type:"DONE",data:{conversationId:t.conversationId}})}),(n=e.signal)==null||n.addEventListener("abort",()=>{r.removeAllListeners(),r.close(),e.onEvent({type:"ERROR",error:"manual aborted request."})}),await r.open(),r.sendPacked({protocol:"json",version:1})}resetConversation(){this.conversationContext=void 0}};var ve=class extends R{constructor(){super("BingChat");this.bingLib=new at,this.status="success",this.init()}async init(){this.log.info("init");let t=await j();t&&(this.status=t.ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_BING?"success":"needAuth")}async auth(){this.active=!0,await this.updateClientStatus("success")}async askChatGPT(t,r,n){var a;let{taskId:i}=r||{};this.log.info("askChatGPT");let u=new AbortController,o=u.signal;i&&(this.taskList[i]=()=>u.abort());let p=(a=this.chatFiles)==null?void 0:a[0];await this.bingLib.doSendMessage({prompt:t,imageUrl:p==null?void 0:p.uploadedUrl,signal:o,onEvent(c){c.type==="ERROR"?n==null||n({type:"error",done:!0,error:c.error,data:{text:"",conversationId:""}}):c.type==="UPDATE_ANSWER"?n==null||n({type:"message",done:!1,error:"",data:{text:c.data.text,conversationId:c.data.conversationId}}):c.type==="DONE"&&(n==null||n({type:"message",done:!0,error:"",data:{text:"",conversationId:c.data.conversationId}}))}})}async uploadFiles(t){this.chatFiles=t,this.chatFiles=await Promise.all(t.map(async r=>{if(r.uploadStatus!=="success"&&r.base64Data){let n=new FormData;n.append("knowledgeRequest",JSON.stringify({imageInfo:{},knowledgeRequest:{invokedSkills:["ImageById"],subscriptionId:"Bing.Chat.Multimodal.Underside",invokedSkillsRequestData:{enableFaceBlur:!0},convoData:{convoid:"",convotone:"Balanced"}}})),n.append("imageBase64",r.base64Data.replace("data:","").replace(/^.+,/,""));let i=await F("https://www.bing.com/images/kblob",{method:"POST",body:n});return i!=null&&i.blobId?(r.uploadedUrl=`https://www.bing.com/images/blob?bcid=${i.blobId}`,r.uploadStatus="success"):(r.uploadStatus="error",r.uploadErrorMessage="Failed to upload image"),this.log.info("uploadFiles",r),r}return r}))}async removeConversation(t){return this.bingLib.resetConversation(),Promise.resolve(!0)}async destroy(){this.bingLib.resetConversation(),await this.clearFiles()}};var ja=P(ar()),$a=P(k());var Da=P(Ra());var Oa=`query ChatViewQuery($bot: String!) {
  chatOfBot(bot: $bot) {
    id
    chatId
    defaultBotNickname
    shouldShowDisclaimer
  }
}
`;var Ua=`mutation AddMessageBreakMutation($chatId: BigInt!) {
  messageBreakCreate(chatId: $chatId) {
    message {
      id
      __typename
      messageId
      text
      linkifiedText
      authorNickname
      state
      vote
      voteReason
      creationTime
      suggestedReplies
    }
  }
}
`;var La=`mutation chatHelpers_sendMessageMutation_Mutation(
  $chatId: BigInt!
  $bot: String!
  $query: String!
  $source: MessageSource
  $withChatBreak: Boolean!
) {
  messageEdgeCreate(chatId: $chatId, bot: $bot, query: $query, source: $source, withChatBreak: $withChatBreak) {
    chatBreak {
      cursor
      node {
        id
        messageId
        text
        author
        suggestedReplies
        creationTime
        state
      }
      id
    }
    message {
      cursor
      node {
        id
        messageId
        text
        author
        suggestedReplies
        creationTime
        state
        chat {
          shouldShowDisclaimer
          id
        }
      }
      id
    }
  }
}
`;var Ga=`mutation subscriptionsMutation($subscriptions: [AutoSubscriptionQuery!]!) {
  autoSubscribe(subscriptions: $subscriptions) {
    viewer {
      id
    }
  }
}
`;var Ma=`subscription messageAdded($chatId: BigInt!) {
  messageAdded(chatId: $chatId) {
    id
    messageId
    creationTime
    state
    ...ChatMessage_message
    ...chatHelpers_isBotMessage
  }
}

fragment ChatMessageDownvotedButton_message on Message {
  ...MessageFeedbackReasonModal_message
  ...MessageFeedbackOtherModal_message
}

fragment ChatMessageDropdownMenu_message on Message {
  id
  messageId
  vote
  text
  linkifiedText
  ...chatHelpers_isBotMessage
}

fragment ChatMessageFeedbackButtons_message on Message {
  id
  messageId
  vote
  voteReason
  ...ChatMessageDownvotedButton_message
}

fragment ChatMessageOverflowButton_message on Message {
  text
  ...ChatMessageDropdownMenu_message
  ...chatHelpers_isBotMessage
}

fragment ChatMessageSuggestedReplies_SuggestedReplyButton_message on Message {
  messageId
}

fragment ChatMessageSuggestedReplies_message on Message {
  suggestedReplies
  ...ChatMessageSuggestedReplies_SuggestedReplyButton_message
}

fragment ChatMessage_message on Message {
  id
  messageId
  text
  author
  linkifiedText
  state
  ...ChatMessageSuggestedReplies_message
  ...ChatMessageFeedbackButtons_message
  ...ChatMessageOverflowButton_message
  ...chatHelpers_isHumanMessage
  ...chatHelpers_isBotMessage
  ...chatHelpers_isChatBreak
  ...chatHelpers_useTimeoutLevel
  ...MarkdownLinkInner_message
}

fragment MarkdownLinkInner_message on Message {
  messageId
}

fragment MessageFeedbackOtherModal_message on Message {
  id
  messageId
}

fragment MessageFeedbackReasonModal_message on Message {
  id
  messageId
}

fragment chatHelpers_isBotMessage on Message {
  ...chatHelpers_isHumanMessage
  ...chatHelpers_isChatBreak
}

fragment chatHelpers_isChatBreak on Message {
  author
}

fragment chatHelpers_isHumanMessage on Message {
  author
}

fragment chatHelpers_useTimeoutLevel on Message {
  id
  state
  text
  messageId
}
`;var Ba=`subscription viewerStateUpdated {
  viewerStateUpdated {
    id
    ...ChatPageBotSwitcher_viewer
  }
}

fragment BotHeader_bot on Bot {
  displayName
  messageLimit {
    dailyLimit
  }
  ...BotImage_bot
}

fragment BotImage_bot on Bot {
  image {
    __typename
    ... on LocalBotImage {
      localName
    }
    ... on UrlBotImage {
      url
    }
  }
  displayName
}

fragment BotLink_bot on Bot {
  displayName
}

fragment ChatPageBotSwitcher_viewer on Viewer {
  availableBots {
    id
    messageLimit {
      dailyLimit
    }
    ...BotLink_bot
    ...BotHeader_bot
  }
  allowUserCreatedBots: booleanGate(gateName: "enable_user_created_bots")
}
`;var cr={AddMessageBreakMutation:Ua,ChatViewQuery:Oa,SendMessageMutation:La,SubscriptionsMutation:Ga,MessageAddedSubscription:Ma,ViewerStateUpdatedSubscription:Ba};async function zc(){let t=(await F("https://poe.com",{parseResponse:u=>u})).match(/<script>if(.+)throw new Error;(.+),window.+<\/script>/)[2],r=t.match(/var .="(\w+)"/)[1],n=Array.from(t.matchAll(/\[(\d+)\]=.\[(\d+)\]/g)).map(u=>[Number(u[1]),Number(u[2])]),i=Array(n.length);for(let[u,o]of n)i[u]=r[o];return i.join("")}async function qa(){let[s,e]=await Promise.all([F("https://poe.com/api/settings"),zc().catch(t=>{throw new Error("Failed to get formkey")})]);return s.formkey=e,s}async function Ce(s,e,t){let n={query:cr[s],variables:e},i=(0,Da.default)(JSON.stringify(n)+t.formkey+"WpuLMiXEKKE98j56k");return F("https://poe.com/api/gql_POST",{method:"POST",body:n,headers:{"poe-formkey":t.formkey,"poe-tag-id":i,"poe-tchannel":t.tchannelData.channel}})}async function Na(s,e){let t=await Ce("ChatViewQuery",{bot:s},e);if(!t.data)throw new Error("[Log into poe.com to continue.](https://www.poe.com)");return t.data.chatOfBot.chatId}async function Jc(s){return $a.default.permissions.request({origins:[s]})}var it=class{async doSendMessage(e){var n,i;if(!await Jc("https://*.poe.com/")){e.onEvent({type:"ERROR",error:"Missing poe.com permission."});return}if(!this.conversationContext){let u=await D(),{poeModel:o}={poeModel:((i=(n=u.thirdProviderSettings)==null?void 0:n.CLAUDE)==null?void 0:i.model)||"a2"};try{let{poeSettings:p,chatId:a}=await this.getChatInfo(o),c=await this.connectWebsocket(p);await this.subscribe(p),this.conversationContext={botId:o,chatId:a,poeSettings:p,wsp:c}}catch(p){e.onEvent({type:"ERROR",error:p.message});return}}let t=this.conversationContext.wsp,r=u=>{var p,a;let o=u.messages.map(c=>JSON.parse(c));for(let c of o)if(c.message_type==="subscriptionUpdate"&&c.payload.subscription_name==="messageAdded"){let l=c.payload.data.messageAdded;e.onEvent({type:"UPDATE_ANSWER",data:{text:l.text,conversationId:String(((p=this.conversationContext)==null?void 0:p.chatId)||"")}}),l.state==="complete"&&(e.onEvent({type:"DONE",data:{conversationId:String(((a=this.conversationContext)==null?void 0:a.chatId)||"")}}),t.onUnpackedMessage.removeAllListeners())}};t.onUnpackedMessage.addListener(r);try{await t.open()}catch(u){t.removeAllListeners(),t.close(),e.onEvent({type:"ERROR",error:"Please ensure [you've logged into poe.com](https://www.poe.com) and retry."});return}try{await this.sendMessageRequest(e.prompt)}catch(u){t.removeAllListeners(),t.close(),e.onEvent({type:"ERROR",error:u.message})}}resetConversation(){if(!this.conversationContext)return;let e=this.conversationContext.wsp;e.removeAllListeners(),e.close(),this.sendChatBreak(),this.conversationContext=void 0}async getChatInfo(e){let t=await qa(),r=await Na(e,t);return{poeSettings:t,chatId:r}}async sendMessageRequest(e){let{poeSettings:t,botId:r,chatId:n}=this.conversationContext;if(!(await Ce("SendMessageMutation",{bot:r,chatId:n,query:e,source:null,withChatBreak:!1},t)).data.messageEdgeCreate.message)throw new Error("You\u2019ve reached the daily free message limit for this model")}async sendChatBreak(){let{chatId:e,poeSettings:t}=this.conversationContext;await Ce("AddMessageBreakMutation",{chatId:e},t)}async subscribe(e){await Ce("SubscriptionsMutation",{subscriptions:[{subscriptionName:"messageAdded",query:cr.MessageAddedSubscription}]},e)}async getWebsocketUrl(e){let t=`tch${Math.floor(Math.random()*1e6)+1}`,r=e.tchannelData;return`wss://${t}.tch.${r.baseHost}/up/${r.boxName}/updates?min_seq=${r.minSeq}&channel=${r.channel}&hash=${r.channelHash}`}async connectWebsocket(e){let t=await this.getWebsocketUrl(e);return new ja.default(t,{packMessage:n=>JSON.stringify(n),unpackMessage:n=>JSON.parse(n)})}};var we=class extends R{constructor(){super("PoeChat");this.poeLib=new it,this.status="success",this.init()}async init(){this.log.info("init");let t=await j();t&&(this.status=t.ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_POE?"success":"needAuth")}async auth(){this.active=!0,await this.updateClientStatus("success")}async askChatGPT(t,r,n){let{taskId:i}=r||{};this.log.info("askChatGPT");let u=new AbortController,o=u.signal;i&&(this.taskList[i]=()=>u.abort()),await this.poeLib.doSendMessage({prompt:t,signal:o,onEvent(p){p.type==="ERROR"?n==null||n({type:"error",done:!0,error:p.error,data:{text:"",conversationId:""}}):p.type==="UPDATE_ANSWER"?n==null||n({type:"message",done:!1,error:"",data:{text:p.data.text,conversationId:p.data.conversationId}}):p.type==="DONE"&&(n==null||n({type:"message",done:!0,error:"",data:{text:"",conversationId:p.data.conversationId}}))}})}resetConversation(){this.poeLib.resetConversation()}};var ur=P(k());var Ha=new B("Background/Chat/ChatSystem"),_e=class{constructor(){this.adapters={};this.sendQuestion=(e,t,r,n)=>{var i;return((i=this.currentAdapter)==null?void 0:i.sendQuestion(e,t,r,n))||Promise.resolve()};this.initChatSystem()}get status(){return this.currentAdapter?this.currentAdapter.status:"needAuth"}get currentAdapter(){return this.currentProvider?this.adapters[this.currentProvider]:void 0}get chatFiles(){var e;return((e=this.currentAdapter)==null?void 0:e.chatFiles)||[]}initChatSystem(){Q(async(e,t,r,n)=>{var i;if(e==="client")switch(t){case"Client_switchChatGPTProvider":{let{provider:u}=r;return await this.switchAdapter(u),{success:!0,data:{provider:u},message:""}}break;case"Client_authChatGPTProvider":{let{provider:u}=r;return await this.switchAdapter(u),await this.auth(((i=n.tab)==null?void 0:i.id)||0),{success:!0,data:{},message:""}}case"Client_checkChatGPTStatus":return{success:!0,data:{status:this.status},message:""};case"Client_createChatGPTConversation":{let u=await this.createConversation();return u?{success:!0,data:{conversationId:u},message:""}:{success:!1,data:{conversationId:u},message:"create conversation failed"}}case"Client_askChatGPTQuestion":{let{taskId:u,question:o,options:p}=r;await this.sendQuestion(u,n,o,p),this.updateClientFiles()}break;case"Client_removeChatGPTConversation":{let{conversationId:u}=r;return{success:await this.removeConversation(u||""),data:{},message:""}}case"Client_abortAskChatGPTQuestion":{let{messageId:u}=r;return await this.abortAskQuestion(u),{success:!0,data:{},message:""}}case"Client_destroyWithLogout":return await this.destroy(),{success:!0,data:{},message:""};case"Client_chatGetFiles":return{success:!0,data:this.chatFiles,message:""};case"Client_chatUploadFiles":{let{files:u}=r;return await this.uploadFiles(u),this.updateClientFiles(),{success:!0,data:this.chatFiles,message:""}}break;case"Client_chatAbortUploadFiles":{let{files:u}=r,o=await this.abortUploadFiles(u.map(p=>p.id));return this.updateClientFiles(),{success:o,data:this.chatFiles,message:""}}break;case"Client_chatRemoveFiles":{let{files:u}=r,o=await this.removeFiles(u.map(p=>p.id));return this.updateClientFiles(),{success:o,data:this.chatFiles,message:""}}break;case"Client_chatClearFiles":{let u=await this.clearFiles();return this.updateClientFiles(),{success:u,data:this.chatFiles,message:""}}break;case"Client_chatUploadFilesChange":{let{files:u}=r;return await this.updateFiles(u),await this.updateClientFiles(),{success:!0,data:{},message:"ok"}}break;case"Client_chatGetUploadFileToken":{let u=await this.getUploadFileToken();return{success:!0,data:u,message:"ok"}}default:break}}),D().then(async e=>{e.chatGPTProvider&&await this.switchAdapter(e.chatGPTProvider)})}addAdapter(e,t){this.adapters[e]=t}async switchAdapter(e){if(e===this.currentProvider){Ha.info("switchAdapter","same provider no need to switch");return}this.currentAdapter&&await this.currentAdapter.destroy(),this.currentProvider=e,await x({chatGPTProvider:e}),await this.preAuth();try{ur.default.runtime.setUninstallURL(`${Oe}/survey/uninstall?version=${ee}&provider=${e}`)}catch(t){Ha.error("switchAdapter","setUninstallURL",t)}return this.currentAdapter}async auth(e){if(this.currentAdapter){await this.currentAdapter.auth(e);let t=await j(),r=`ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_${this.currentProvider}`;Object.prototype.hasOwnProperty.call(t,r)&&await Sr(r,!0)}}async preAuth(){if(this.currentAdapter){let e=await j(),t=`ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_${this.currentProvider}`;Object.prototype.hasOwnProperty.call(e,t)?e[t]?await this.currentAdapter.preAuth():await W("Client_ChatGPTStatusUpdate",{status:"needAuth"}):await this.currentAdapter.preAuth()}}async abortAskQuestion(e){return this.currentAdapter?await this.currentAdapter.abortAskQuestion(e):!1}async createConversation(){var e;return this.currentAdapter&&await((e=this.currentAdapter)==null?void 0:e.createConversation())||""}async removeConversation(e){var r;return this.currentAdapter?await((r=this.currentAdapter)==null?void 0:r.removeConversation(e)):!1}async destroy(){var e,t;await ur.default.storage.local.set({[yr]:JSON.stringify([])}),await x({conversationId:""}),await((e=this.currentAdapter)==null?void 0:e.destroy()),await((t=this.currentAdapter)==null?void 0:t.clearFiles())}async uploadFiles(e){if(!!this.currentAdapter)return await this.currentAdapter.uploadFiles(e)}async updateFiles(e){if(!!this.currentAdapter)return await this.currentAdapter.updateFiles(e)}async abortUploadFiles(e){return this.currentAdapter?await this.currentAdapter.abortUploadFiles(e):!1}async removeFiles(e){return this.currentAdapter?await this.currentAdapter.removeFiles(e):!1}async getFiles(){return this.chatFiles}async getUploadFileToken(){return this.currentAdapter?await this.currentAdapter.getUploadFileToken():null}async clearFiles(){return this.currentAdapter?await this.currentAdapter.clearFiles():!1}async updateClientFiles(){W("Client_listenUploadFilesChange",{files:this.chatFiles})}};var be=class{constructor(e){this.sendQuestion=(e,t,r,n)=>this.openAIChat.sendQuestion(e,t,r,n);this.openAIChat=e}async preAuth(){return this.openAIChat.preAuth()}async auth(e){await this.openAIChat.auth(e)}get status(){return this.openAIChat.status}async abortAskQuestion(e){return await this.openAIChat.abortAskQuestion(e)}async createConversation(){return await this.openAIChat.createConversation()}async removeConversation(e){return await this.openAIChat.removeConversation(e)}destroy(){return this.openAIChat.destroy()}get chatFiles(){return this.openAIChat.chatFiles}async uploadFiles(e){return await this.openAIChat.uploadFiles(e)}async updateFiles(e){return await this.openAIChat.updateFiles(e)}async removeFiles(e){return await this.openAIChat.removeFiles(e)}async getFiles(){return await this.openAIChat.getFiles()}async getUploadFileToken(){return await this.openAIChat.getUploadFileToken()}async abortUploadFiles(e){return await this.openAIChat.abortUploadFiles(e)}async clearFiles(){return await this.openAIChat.clearFiles()}};var G=class{constructor(e){this.sendQuestion=(e,t,r,n)=>this.chatAdapter.sendQuestion(e,t,r,n);this.chatAdapter=e}async preAuth(){await this.chatAdapter.preAuth()}async auth(e){await this.chatAdapter.auth(e)}get status(){return this.chatAdapter.status}async abortAskQuestion(e){return await this.chatAdapter.abortAskQuestion(e)}async destroy(){await this.chatAdapter.destroy()}async createConversation(){return await this.chatAdapter.createConversation()}async removeConversation(e){return await this.chatAdapter.removeConversation(e)}get chatFiles(){return this.chatAdapter.chatFiles}async getUploadFileToken(){return await this.chatAdapter.getUploadFileToken()}async updateFiles(e){await this.chatAdapter.updateFiles(e)}async uploadFiles(e){return await this.chatAdapter.uploadFiles(e)}async abortUploadFiles(e){return await this.chatAdapter.abortUploadFiles(e)}async removeFiles(e){return await this.chatAdapter.removeFiles(e)}async getFiles(){return await this.chatAdapter.getFiles()}async clearFiles(){return await this.chatAdapter.clearFiles()}};var Wa=P(k());var Ie=class{constructor(e){this.sendQuestion=async(e,t,r,n)=>{let i=_();await this.openAiApiChat.askChatGPT(r.question,{taskId:r.messageId,regenerate:n.regenerate,include_history:n.includeHistory,max_history_message_cnt:n.maxHistoryMessageCnt},async({type:u,done:o,error:p,data:a})=>{var c;(c=t.tab)!=null&&c.id&&await this.sendResponseToClient(t.tab.id,{taskId:e,data:{text:a.text,parentMessageId:r.messageId,conversationId:a.conversationId,messageId:i},error:p,done:o})})};this.openAiApiChat=e}async auth(e){await this.openAiApiChat.auth()}async preAuth(){await this.openAiApiChat.preAuth()}get status(){return this.openAiApiChat.checkApiKey(),this.openAiApiChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(e){return await x({conversationId:""}),await this.openAiApiChat.resetMessagesContext(),Promise.resolve(!0)}async abortAskQuestion(e){return await this.openAiApiChat.abortTask(e)}async destroy(){await this.openAiApiChat.destroy()}async sendResponseToClient(e,t){await Wa.default.tabs.sendMessage(e,{id:w,event:"Client_askChatGPTQuestionResponse",data:t})}get chatFiles(){return this.openAiApiChat.chatFiles}async uploadFiles(e){return await this.openAiApiChat.uploadFiles(e)}async updateFiles(e){return await this.openAiApiChat.updateFiles(e)}async getUploadFileToken(){return await this.openAiApiChat.getUploadFileToken()}async removeFiles(e){return await this.openAiApiChat.removeFiles(e)}async getFiles(){return await this.openAiApiChat.getFiles()}async abortUploadFiles(e){return await this.openAiApiChat.abortUploadFiles(e)}async clearFiles(){return await this.openAiApiChat.clearFiles()}};var Qa=P(k());var Ae=class{constructor(e){this.sendQuestion=async(e,t,r,n)=>{let i=_();await this.useChatGPTPlusChat.askChatGPT(r.question,{taskId:r.messageId,regenerate:n.regenerate,include_history:n.includeHistory,max_history_message_cnt:n.maxHistoryMessageCnt},async({type:u,done:o,error:p,data:a})=>{var c;(c=t.tab)!=null&&c.id&&await this.sendResponseToClient(t.tab.id,{taskId:e,data:{text:a.text,parentMessageId:r.messageId,conversationId:a.conversationId,messageId:i},error:p,done:o})})};this.useChatGPTPlusChat=e}async auth(e){await this.useChatGPTPlusChat.auth(e)}async preAuth(){await this.useChatGPTPlusChat.preAuth()}get status(){return this.useChatGPTPlusChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(e){return await x({conversationId:""}),Promise.resolve(!0)}async abortAskQuestion(e){return await this.useChatGPTPlusChat.abortTask(e)}async destroy(){await this.useChatGPTPlusChat.destroy()}async sendResponseToClient(e,t){await Qa.default.tabs.sendMessage(e,{id:w,event:"Client_askChatGPTQuestionResponse",data:t})}get chatFiles(){return this.useChatGPTPlusChat.chatFiles}async uploadFiles(e){return await this.useChatGPTPlusChat.uploadFiles(e)}async updateFiles(e){return await this.useChatGPTPlusChat.updateFiles(e)}async getUploadFileToken(){return await this.useChatGPTPlusChat.getUploadFileToken()}async removeFiles(e){return await this.useChatGPTPlusChat.removeFiles(e)}async getFiles(){return await this.useChatGPTPlusChat.getFiles()}async abortUploadFiles(e){return await this.useChatGPTPlusChat.abortUploadFiles(e)}async clearFiles(){return await this.useChatGPTPlusChat.clearFiles()}};var Va=P(k());var Pe=class{constructor(e){this.sendQuestion=async(e,t,r,n)=>{let i=_();await this.bardChat.askChatGPT(r.question,{taskId:r.messageId,regenerate:n.regenerate,include_history:n.includeHistory,max_history_message_cnt:n.maxHistoryMessageCnt},async({type:u,done:o,error:p,data:a})=>{var c;(c=t.tab)!=null&&c.id&&await this.sendResponseToClient(t.tab.id,{taskId:e,data:{text:a.text,parentMessageId:r.messageId,conversationId:a.conversationId,messageId:i},error:p,done:o})})};this.bardChat=e}async auth(e){await this.bardChat.auth()}async preAuth(){await this.bardChat.checkAuth()}get status(){return this.bardChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(e){return await this.bardChat.reset(),await x({conversationId:""}),Promise.resolve(!0)}async abortAskQuestion(e){return await this.bardChat.abortTask(e)}async destroy(){await this.bardChat.destroy()}async sendResponseToClient(e,t){await Va.default.tabs.sendMessage(e,{id:w,event:"Client_askChatGPTQuestionResponse",data:t})}get chatFiles(){return this.bardChat.chatFiles}async updateFiles(e){return await this.bardChat.updateFiles(e)}async uploadFiles(e){return await this.bardChat.uploadFiles(e)}async getUploadFileToken(){return await this.bardChat.getUploadFileToken()}async removeFiles(e){return await this.bardChat.removeFiles(e)}async getFiles(){return await this.bardChat.getFiles()}async abortUploadFiles(e){return await this.bardChat.abortUploadFiles(e)}async clearFiles(){return await this.bardChat.clearFiles()}};var za=P(k());var Se=class{constructor(e){this.sendQuestion=async(e,t,r,n)=>{let i=_();await this.bingChat.askChatGPT(r.question,{taskId:r.messageId,regenerate:n.regenerate,include_history:n.includeHistory,max_history_message_cnt:n.maxHistoryMessageCnt},async({type:u,done:o,error:p,data:a})=>{var c;(c=t.tab)!=null&&c.id&&await this.sendResponseToClient(t.tab.id,{taskId:e,data:{text:a.text,parentMessageId:r.messageId,conversationId:a.conversationId,messageId:i},error:p,done:o})})};this.bingChat=e}async auth(e){await this.bingChat.auth()}async preAuth(){await this.bingChat.auth()}get status(){return this.bingChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(e){return await x({conversationId:""}),await this.bingChat.removeConversation(e),Promise.resolve(!0)}async abortAskQuestion(e){return await this.bingChat.abortTask(e)}async destroy(){await this.bingChat.destroy()}async sendResponseToClient(e,t){await za.default.tabs.sendMessage(e,{id:w,event:"Client_askChatGPTQuestionResponse",data:t})}get chatFiles(){return this.bingChat.chatFiles}async updateFiles(e){return await this.bingChat.updateFiles(e)}async uploadFiles(e){return await this.bingChat.uploadFiles(e)}async getUploadFileToken(){return await this.bingChat.getUploadFileToken()}async removeFiles(e){return await this.bingChat.removeFiles(e)}async getFiles(){return await this.bingChat.getFiles()}async abortUploadFiles(e){return await this.bingChat.abortUploadFiles(e)}async clearFiles(){return await this.bingChat.clearFiles()}};var Ja=P(k());var Te=class{constructor(e){this.sendQuestion=async(e,t,r,n)=>{let i=_();await this.poeChat.askChatGPT(r.question,{taskId:r.messageId,regenerate:n.regenerate,include_history:n.includeHistory,max_history_message_cnt:n.maxHistoryMessageCnt},async({type:u,done:o,error:p,data:a})=>{var c;(c=t.tab)!=null&&c.id&&await this.sendResponseToClient(t.tab.id,{taskId:e,data:{text:a.text,parentMessageId:r.messageId,conversationId:a.conversationId,messageId:i},error:p,done:o})})};this.poeChat=e}async auth(e){await this.poeChat.auth()}async preAuth(){await this.poeChat.auth()}get status(){return this.poeChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(e){return await x({conversationId:""}),this.poeChat.resetConversation(),Promise.resolve(!0)}async abortAskQuestion(e){return await this.poeChat.abortTask(e)}async destroy(){await this.poeChat.destroy()}async sendResponseToClient(e,t){await Ja.default.tabs.sendMessage(e,{id:w,event:"Client_askChatGPTQuestionResponse",data:t})}get chatFiles(){return this.poeChat.chatFiles}async uploadFiles(e){return await this.poeChat.uploadFiles(e)}async updateFiles(e){return await this.poeChat.updateFiles(e)}async removeFiles(e){return await this.poeChat.removeFiles(e)}async getFiles(){return await this.poeChat.getFiles()}async getUploadFileToken(){return await this.poeChat.getUploadFileToken()}async abortUploadFiles(e){return await this.poeChat.abortUploadFiles(e)}async clearFiles(){return await this.poeChat.clearFiles()}};var Ka=P(k());var Ee=class{constructor(e){this.sendQuestion=async(e,t,r,n)=>{let i=_();await this.claudeChat.askChatGPT(r.question,{taskId:r.messageId,regenerate:n.regenerate,include_history:n.includeHistory,max_history_message_cnt:n.maxHistoryMessageCnt},async({type:u,done:o,error:p,data:a})=>{var c;(c=t.tab)!=null&&c.id&&await this.sendResponseToClient(t.tab.id,{taskId:e,data:{text:a.text,parentMessageId:r.messageId,conversationId:a.conversationId,messageId:i},error:p,done:o})})};this.claudeChat=e}async auth(e){await this.claudeChat.auth()}async preAuth(){await this.claudeChat.preAuth()}get status(){return this.claudeChat.status}async createConversation(){return await this.claudeChat.createConversation()}async removeConversation(e){return await this.claudeChat.removeConversation(e),await x({conversationId:""}),Promise.resolve(!0)}async abortAskQuestion(e){return await this.claudeChat.abortTask(e)}async destroy(){await this.claudeChat.destroy()}async sendResponseToClient(e,t){await Ka.default.tabs.sendMessage(e,{id:w,event:"Client_askChatGPTQuestionResponse",data:t})}get chatFiles(){return this.claudeChat.chatFiles}async updateFiles(e){return await this.claudeChat.updateFiles(e)}async uploadFiles(e){return await this.claudeChat.uploadFiles(e)}async getUploadFileToken(){return await this.claudeChat.getUploadFileToken()}async removeFiles(e){return await this.claudeChat.removeFiles(e)}async getFiles(){return await this.claudeChat.getFiles()}async abortUploadFiles(e){return await this.claudeChat.abortUploadFiles(e)}async clearFiles(){return await this.claudeChat.clearFiles()}};var S=P(k());var Kc=new B("Background/Client"),Xa=()=>{Q(async(s,e,t,r)=>{var n,i,u,o,p;if(s==="client")switch(e){case"Client_ping":return{data:!0,success:!0,message:"ok"};case"Client_openUrl":{let{url:a,key:c,query:l=""}=t;if(a)return await S.default.tabs.create({url:a}),{data:!0,success:!0,message:"ok"};if(c)return c==="current_page"?(n=r.tab)!=null&&n.id&&await S.default.tabs.update(r.tab.id,{active:!0}):c==="shortcuts"?await S.default.tabs.create({url:"chrome://extensions/shortcuts",active:!0}):c==="options"?await ft(l):c==="chatgpt"?await ue():c==="manage_extension"&&await S.default.tabs.create({url:`chrome://extensions/?id=${S.default.runtime.id}`,active:!0}),{data:!0,success:!0,message:"ok"}}break;case"Client_updateIcon":{let{mode:a}=t;return H?{data:!1,success:!1,message:"ok"}:(a==="dark"?await S.default.action.setIcon({path:{16:"assets/USE_CHAT_GPT_AI/icons/maxai_16_normal_dark.png",32:"assets/USE_CHAT_GPT_AI/icons/maxai_32_normal_dark.png",48:"assets/USE_CHAT_GPT_AI/icons/maxai_48_normal_dark.png",128:"assets/USE_CHAT_GPT_AI/icons/maxai_128_normal_dark.png"}}):await S.default.action.setIcon({path:{16:"assets/USE_CHAT_GPT_AI/icons/maxai_16_normal.png",32:"assets/USE_CHAT_GPT_AI/icons/maxai_32_normal.png",48:"assets/USE_CHAT_GPT_AI/icons/maxai_48_normal.png",128:"assets/USE_CHAT_GPT_AI/icons/maxai_128_normal.png"}}),{data:!0,success:!0,message:"ok"})}break;case"Client_getChromeExtensionCommands":return{data:await S.default.commands.getAll()||[],success:!0,message:"ok"};case"Client_updateTabVisible":{let{visible:a,windowVisible:c,windowFocus:l}=t||{};if((i=r.tab)!=null&&i.id){let h=await S.default.tabs.update(r.tab.id,{active:a});if(h.windowId){let d=await S.default.windows.get(h.windowId);if(d.id&&d.id!==S.default.windows.WINDOW_ID_NONE){let m=await Ar()!==d.id||c?void 0:"minimized";(await S.default.tabs.query({windowId:d.id})).length===1&&await S.default.windows.update(d.id,{focused:l,state:m})}}}return{data:!0,success:!0,message:"ok"}}break;case"Client_updateIframeInput":return(u=r.tab)!=null&&u.id&&await S.default.tabs.sendMessage(r.tab.id,{event:"Client_listenUpdateIframeInput",data:t,id:w}),{data:!0,success:!0,message:"ok"};case"Client_restartApp":return await De(),{data:!0,success:!0,message:"ok"};case"Client_logCallApiRequest":return{data:await Rr(t),success:!0,message:"ok"};case"Client_updateUseChatGPTAuthInfo":{let a=await Ne(),{accessToken:c,refreshToken:l,userInfo:h}=t;if(Kc.info("Client_updateUseChatGPTAuthInfo",c,l,h),c&&l){let d=await S.default.storage.local.get(Re);await S.default.storage.local.set({[Re]:{accessToken:c,refreshToken:l,userInfo:h,userData:(o=d[Re])==null?void 0:o.userData}})}else await Be();return!a&&c&&await ft("",!1),await S.default.tabs.update((p=r.tab)==null?void 0:p.id,{active:!0}),{data:!0,success:!0,message:"ok"}}break;case"Client_getUseChatGPTUserInfo":{let a=await yt(!1);return{success:!0,data:a,message:"ok"}}break;case"Client_getUseChatGPTUserSubscriptionInfo":{let a=await yt(!0);return{success:!0,data:a==null?void 0:a.role,message:"ok"}}break;default:break}})};var ot=P(k());var Xc=new B("PDF"),Ya=async()=>{ot.default.tabs.onUpdated.addListener(async(s,e,t)=>{var r,n;if(t.active){let i=t.url||t.pendingUrl;if(((i==null?void 0:i.startsWith("file://"))||(i==null?void 0:i.startsWith("ftp://")))&&(i.endsWith(".pdf")||i.endsWith(".PDF"))&&(n=(r=(await D()).userSettings)==null?void 0:r.pdf)!=null&&n.enabled){let o=`chrome-extension://${ot.default.runtime.id}/pages/pdf/web/viewer.html?file=${encodeURIComponent(i)}`;Xc.info("pdfSnifferStartListener success",i,o),await ot.default.tabs.update(s,{url:o})}}})};var Za=()=>{Q(async(s,e,t,r)=>{if(s==="shortcut")switch(e){case"ShortCuts_getContentOfURL":{let{URL:n}=t,i=await Er(n);return{data:i,success:i.success,message:"ok"}}case"ShortCuts_getContentOfSearchEngine":{let{URL:n}=t,i=await kr(n);return{data:i,success:i.success,message:"ok"}}default:break}})};var ke=async()=>{var t;let e=await(await fetch("https://claude.ai/api/organizations",{redirect:"error",cache:"no-cache"})).json();return(t=e==null?void 0:e[0])==null?void 0:t.uuid},ei=async(s,e)=>{try{if(!s)return;let t=_(),r=await fetch(`https://claude.ai/api/organizations/${s}/chat_conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e||"",uuid:t})});if(r.status===201||r.status===200){let n=await r.json();return n.uuid?n:void 0}else return}catch(t){return}},Yc=async s=>{try{let e=await fetch(`https://claude.ai/api/organizations/${s}/chat_conversations`,{method:"GET"});if(e.status===200){let t=await e.json();return t.length?t:[]}return[]}catch(e){return[]}},ti=async(s,e)=>{let t=await Yc(s);t=t.filter(n=>n.name===e);let r=[];for(;t.length;)r=t.splice(0,5).map(n=>n.uuid),await Promise.all(r.map(n=>lr(s,n))),await new Promise(n=>setTimeout(n,5e3))},lr=async(s,e)=>{try{let t=await fetch(`https://claude.ai/api/organizations/${s}/chat_conversations/${e}`,{method:"DELETE"});return t.status===204||t.status===200}catch(t){return!1}},ri=async(s,e,t)=>{let r=new FormData;r.append("file",e,t||(e==null?void 0:e.name)||""),r.append("orgUuid",s);let n=await fetch("https://claude.ai/api/convert_document",{method:"POST",body:r});if(n.status===200){let u=await n.json();if(u.extracted_content)return u.file_name=t||(e==null?void 0:e.name)||u.file_name||"",{success:!0,data:u,error:""}}let i="Upload failed.";return n.status===429&&(i="Exceeded file upload rate limit"),{success:!1,data:void 0,error:i}};var ct=class{constructor(e){this.attachments=[];this.organizationId=e}get conversationId(){var e;return(e=this.conversation)==null?void 0:e.uuid}async createConversation(e){var t;return this.organizationId||(this.organizationId=await ke()),this.organizationId&&(this.conversation=await ei(this.organizationId,e)),((t=this.conversation)==null?void 0:t.uuid)||""}async sendMessage(e,t){var p;let{regenerate:r=!1,onMessage:n}=t||{},i=(p=this.conversation)==null?void 0:p.uuid;if(!i||!this.organizationId){if(i=await this.createConversation(),!i||!this.organizationId){n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:"Please log into [Claude.ai](https://claude.ai/chats) and try again."});return}return}this.abortController=new AbortController;let u=this.abortController.signal,o=r?"https://claude.ai/api/retry_message":"https://claude.ai/api/append_message";r&&(e=""),await Ue(o,{signal:u,method:"POST",provider:"CLAUDE",headers:{"Content-Type":"application/json"},body:JSON.stringify({attachments:this.attachments.map(a=>{let c=Cr(a);return delete c.id,c}),completion:{incremental:!0,model:"claude-2",prompt:e,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},conversation_uuid:i,organization_uuid:this.organizationId,text:e}),onMessage:a=>{try{let c=JSON.parse(a);c.log_id&&(n==null||n(c))}catch(c){}}}).then(()=>{}).catch(a=>{var c;if(a!=null&&a.message.includes("The user aborted a request.")){n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:"The user aborted a request."});return}try{let l=JSON.parse(a.message),h=((c=l==null?void 0:l.error)==null?void 0:c.message)||(l==null?void 0:l.message)||"Network Error";n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:h})}catch(l){n==null||n({completion:"",log_id:"",messageLimit:{type:"within_limit"},model:"",stop:!0,stop_reason:"Network Error"})}}),this.resetAttachments()}abortSendMessage(){var e;(e=this.abortController)==null||e.abort()}async resetConversation(){var e;if(((e=this.conversation)==null?void 0:e.uuid)&&this.organizationId){let t=await lr(this.organizationId,this.conversation.uuid)}return this.conversation=void 0,!0}async uploadAttachment(e,t){if(!this.organizationId&&(this.organizationId=await ke(),!this.organizationId))return{success:!1,error:"organization id not found",data:void 0};if(e.size>10*1024*1024)return{success:!1,error:"file size too large",data:void 0};let r=await ri(this.organizationId,e,t||e.name);if(r.success&&r.data){let n=r.data;return n.id=_(),this.attachments.push(n),{success:!0,error:void 0,data:n}}else return{success:!1,error:r.error||"Upload failed.",data:void 0}}resetAttachments(){return this.attachments=[],!0}removeAttachment(e){let t=this.attachments.findIndex(r=>r.id===e);return t>-1&&this.attachments.splice(t,1),!0}};var ce=P(k());var oe="CHROME_EXTENSION_LOCAL_STORAGE_CLAUDE_TOKEN_KEY",si="MaxAI.me",ut=class extends R{constructor(){super("ClaudeChat");this.claude=new ct,this.status="needAuth"}async init(){this.log.info("init")}async preAuth(){this.active=!0;let t=await ce.default.storage.local.get(oe);t[oe]&&(this.claude.organizationId=t[oe]),this.status=this.claude.organizationId?"success":"needAuth",await this.updateClientStatus(this.status)}async auth(){this.active=!0,this.claude.organizationId=await ke(),this.claude.organizationId?(this.status="success",await ce.default.storage.local.set({[oe]:this.claude.organizationId}),await this.updateClientStatus("success")):await ce.default.tabs.create({url:"https://claude.ai/chats",active:!0})}async createConversation(){if(this.claude.conversationId)return this.claude.conversationId;let t=await this.claude.createConversation(si);return this.claude.organizationId?await ce.default.storage.local.set({[oe]:this.claude.organizationId}):(await ce.default.storage.local.remove(oe),this.status="needAuth",await this.updateClientStatus("needAuth")),t}async askChatGPT(t,r,n){let{regenerate:i}=r||{},u="";this.log.info("ClaudeChat send"),await this.claude.sendMessage(t,{regenerate:i,onMessage:o=>{o.stop?o.stop_reason==="stop_sequence"?n==null||n({type:"message",done:!0,error:"",data:{text:u,conversationId:this.claude.conversationId}}):o.stop_reason==="The user aborted a request."?n==null||n({type:"error",error:"manual aborted request.",done:!0,data:{text:"",conversationId:this.claude.conversationId}}):n==null||n({type:"error",done:!0,error:o.stop_reason||"Network Error",data:{text:u,conversationId:this.claude.conversationId}}):(u+=o.completion||"",n==null||n({type:"message",done:!1,error:"",data:{text:u,conversationId:this.claude.conversationId}}))}}),await this.clearFiles()}async abortTask(t){return this.claude.abortSendMessage(),!0}async removeConversation(t){await this.claude.resetConversation(),this.claude.organizationId&&ti(this.claude.organizationId,si).then().catch()}async getUploadFileToken(){return this.claude.organizationId||await this.auth(),this.claude.organizationId}async uploadFiles(t){this.chatFiles=t,this.chatFiles=await Promise.all(t.map(async r=>{if(r.uploadStatus!=="success"){let[n,i]=qe(r.file),u=new Blob([n],{type:i});if(i.includes("pdf")){let o=await this.claude.uploadAttachment(u,r.fileName);return o.success&&o.data?{...r,id:o.data.id,file:void 0,uploadStatus:"success",uploadProgress:100}:{...r,file:void 0,uploadStatus:"error",uploadProgress:0,uploadErrorMessage:o.error}}else{let o=await u.text(),p={id:_(),extracted_content:o,file_name:r.fileName,file_size:r.fileSize,file_type:i,totalPages:1};return this.claude.attachments.push(p),{...r,id:p.id,file:void 0,uploadStatus:"success",uploadProgress:100}}}return r}))}async removeFiles(t){return await super.removeFiles(t),t.forEach(r=>{this.claude.removeAttachment(r)}),!0}async destroy(){await this.clearFiles(),this.claude.resetAttachments(),this.status="needAuth",await this.updateClientStatus("needAuth"),this.active=!1}};var ni=()=>{v.default.management.getAll(),v.default.storage.onChanged.addListener(()=>{}),v.default.scripting.getRegisteredContentScripts(),Zc(),eu(),ru(),su(),au(),nu(),tu(),Ya().then().catch(),iu()},Zc=()=>{v.default.runtime.onInstalled.addListener(async s=>{s.reason===v.default.runtime.OnInstalledReason.INSTALL?(await Tr(),await v.default.tabs.create({url:ht+"/get-started"}),await v.default.storage.local.set({[Or]:!1})):await _r()||(await br()).success&&await wr();try{await v.default.contextMenus.remove("use-chatgpt-ai-context-menu-button")}catch(e){}await v.default.contextMenus.create({id:"use-chatgpt-ai-context-menu-button",title:"MaxAI.me",contexts:["all"]})})},eu=()=>{Xa(),Za(),v.default.runtime.onMessage.addListener((p,a,c)=>{var l;(p==null?void 0:p.id)&&p.id!==w||p.type==="inboxsdk__injectPageWorld"&&a.tab&&v.default.scripting&&((l=a.tab)==null?void 0:l.id)&&(v.default.scripting.executeScript({target:{tabId:a.tab.id},world:"MAIN",files:["pageWorld.js"]}),c(!0))});let s=new _e,e=new G(new be(new le)),t=new G(new Ae(new he)),r=new G(new Ie(new dt)),n=new G(new Pe(new pe)),i=new G(new Se(new ve)),u=new G(new Te(new we)),o=new G(new Ee(new ut));s.addAdapter(M.OPENAI,e),s.addAdapter(M.OPENAI_API,r),s.addAdapter(M.USE_CHAT_GPT_PLUS,t),s.addAdapter(M.BING,i),s.addAdapter(M.BARD,n),s.addAdapter(M.POE,u),s.addAdapter(M.CLAUDE,o)},tu=()=>{H||v.default.runtime.setUninstallURL(`${Oe}/survey/uninstall?version=${ee}`)},ru=()=>{H||v.default.commands.onCommand.addListener(async s=>{if(s=="_execute_action"){let t=(await v.default.tabs.query({active:!0,currentWindow:!0}))[0];t&&t.id&&await Me(t.id,"Client_listenOpenChatMessageBox",{type:"shortcut",command:s})}else if(s==="show-floating-menu"){let t=(await v.default.tabs.query({active:!0,currentWindow:!0}))[0];t&&t.id&&await Me(t.id,"Client_listenOpenChatMessageBox",{type:"shortcut",command:s})}})},su=()=>{if(H)v.default.action.onClicked.addListener(async s=>{s&&s.id&&s.active&&await v.default.tabs.create({url:ht})});else{let s=async e=>{var t,r,n;try{let i=e,u=(i==null?void 0:i.url)||"",o="";((t=i==null?void 0:i.url)==null?void 0:t.startsWith("chrome"))||((r=i==null?void 0:i.url)==null?void 0:r.startsWith("https://chrome.google.com/webstore"))||((n=i==null?void 0:i.url)==null?void 0:n.startsWith("https://chat.openai.com"))?u.startsWith("chrome://extensions/shortcuts")||(o="pages/popup/index.html"):i&&i.id&&(await v.default.tabs.sendMessage(i.id,{}),o=""),await v.default.action.setPopup({popup:o})}catch(i){await v.default.action.setPopup({popup:"pages/popup/index.html"})}};v.default.tabs.onActivated.addListener(async({tabId:e})=>{await s(await v.default.tabs.get(e))}),v.default.tabs.onUpdated.addListener(async(e,t,r)=>{t.status==="complete"&&r.active&&await s(r)}),v.default.action.onClicked.addListener(async e=>{if(e&&e.id&&e.active){if(e.url==="chrome://extensions/shortcuts")return;await Me(e.id,"Client_listenOpenChatMessageBox",{type:"shortcut"})||await v.default.action.setPopup({popup:"pages/popup/index.html"})}})}},nu=()=>{H||v.default.management.onDisabled.addListener(function(s){s.id===v.default.runtime.id&&v.default.action.setPopup({popup:"pages/popup/index.html"})})},au=()=>{H||v.default.contextMenus.onClicked.addListener(async(s,e)=>{s.menuItemId==="use-chatgpt-ai-context-menu-button"&&e&&e.id&&await v.default.tabs.sendMessage(e.id,{id:w,event:"Client_listenOpenChatMessageBox",data:{}})})},iu=()=>{mr||new WebSocket("ws://localhost:8181").addEventListener("message",e=>{e.data==="hot_reload_message"&&De().then(()=>{})})};ni();
/* chnl v1.2.0 by Vitaliy Potapov @preserve */
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
