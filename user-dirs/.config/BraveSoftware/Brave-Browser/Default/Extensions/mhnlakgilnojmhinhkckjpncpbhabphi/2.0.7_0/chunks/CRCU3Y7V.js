import{a as We}from"./OTE5SEU6.js";import{a as ot}from"./GCPSMIV2.js";import{a as ze}from"./WYSBWNIM.js";import{a as Ve}from"./IGNWSMS2.js";import{P as De,fa as nt,ga as Oe,h as Te,ia as He,l as Ce,m as ve,n as Ie,o as be,oa as Ne,pa as Ue,x as Le,y as ke,z as Ae}from"./36BQJYSV.js";import{f as Pe}from"./EF5GRFCD.js";import{a as Ge}from"./LN7GN6PK.js";import{J as Me,L as _e,R as Re,S as Be,T as H,U as ne,V as oe,W as Fe}from"./VV54QQJA.js";import{b as xe}from"./5T4V74FX.js";import{a as te}from"./KSWBD2TZ.js";import{a as F}from"./ABULMT32.js";import{d as $}from"./MKFZQTYG.js";import{D as K,a as v,r as I}from"./23DIE7BK.js";import{$ as ye,C as he,V as we,X as Se,l as B,y as Y}from"./BK6QTIUI.js";import{L as Ee,O as j,ba as _}from"./VYGUKUEK.js";import{d as V,e as G,f as R,h as ge,i as J}from"./X6PP3PBE.js";import{a as tt,b as ee,g as fe,m as pe,p as q}from"./BR2YNKDZ.js";import{a as z}from"./BIAB2ZEP.js";import{e as A}from"./O5NYTI7P.js";var e=A(z());var qe=A(z());var rt=()=>{(0,qe.useEffect)(()=>{let s=new j,c=()=>{let o=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;s.postMessage({event:"Client_updateIcon",data:{mode:o?"dark":"light"}})};return window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",c),c(),()=>{window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",c),s==null||s.destroy()}},[])},Je=rt;var ie=A(ot()),p=A(z());var je=(s,c,o,i,l)=>new Promise(n=>{let u=!1,S=setTimeout(()=>{u=!0,n(void 0)},i),E=setInterval(()=>{if(!u){let y=Array.from(s.querySelectorAll(c));if(l){let D=l(y);D&&(clearInterval(E),clearTimeout(S),n(D))}else y.length>0&&(clearInterval(E),clearTimeout(S),n(y[0]))}},o)}),it=()=>new Promise(async s=>{var l;let o=setTimeout(()=>{s({success:!1,error:"timeout"})},4e3),i=n=>{clearTimeout(o),s(n)};try{let n=(l=document.getElementById(q))==null?void 0:l.shadowRoot;if(n){let u=await je(n,".usechatgpt-ai__context-menu--handle-button",200,2e3,S=>S.find(E=>window.getComputedStyle(E).opacity!=="0"));if(u){setTimeout(()=>{u.click()},100);let S=await je(n,".floating-context-menu-item",50,2e3,E=>E.find(y=>y.innerText.startsWith("Run this prompt")));if(S){S.click(),i({success:!0,error:""});return}}}i({success:!1,error:"no context menu"})}catch(n){i({success:!1,error:(n==null?void 0:n.toString())||""})}}),re=it;ze(ie.default);Ve(ie.default);var T=new Y("ContextMenu/Rangy"),st=new j({runtime:"client"}),at=()=>{let{show:s,initRangyCore:c,rangy:o,showRangy:i,hideRangy:l,saveTempSelection:n,currentSelection:u}=Le(),E=V(J).userSettings,{chatBoxShortCutKey:y}=_e(),[,D]=G(Ce),[,Xe]=G(be),ae=R(ve);Fe();let[N,Qe]=G(Ie),w=(0,p.useRef)(null),r=(0,p.useRef)(null),{showFloatingContextMenuWithVirtualElement:Ze}=He();F(()=>{Promise.all([import("./XAEAKHAV.js"),import("./6BOTHPIG.js"),import("./OIFPGVHO.js")]).then(([{default:a},{default:m},{default:d}])=>{let t=()=>{c(a)};m(a),d(a),a.init(),a.addInitListener(t)})});let le=(0,p.useRef)(s);(0,p.useEffect)(()=>{le.current=s},[s]);let b=(0,p.useCallback)(a=>{var m,d,t,g,C,h,x,O,U,W,M,L;{if(le.current&&a instanceof KeyboardEvent&&a.key==="Escape"){T.info("Escape close floating button"),l(),Re(),Be(),ae(k=>(k.range&&setTimeout(()=>{var P,de;(P=window.getSelection())==null||P.removeAllRanges(),(de=window.getSelection())==null||de.addRange(k.range)},100),{range:null}));return}let f=a.target,ue=a instanceof MouseEvent,me=oe(),et=(o.getSelection().toString()||((m=document==null?void 0:document.getSelection())==null?void 0:m.toString())||"").trim().replace(/\u200B/g,"");if(f){if(f&&(f.id===fe||f.id===q||f.id===pe))return;if(w.current&&(f=w.current),me){let P=H(me);P.isEditableElement&&(f=P.editableElement)}if(!f)return;let{editableElement:k}=H(f);if(k&&(f=k),!k&&!et){l(),r.current=null;return}r.current=ne(f,{target:f,eventType:ue?"mouseup":"keyup"}),T.info(`native selection [${ue?"mouse":"keyboard"}]: 	`,r.current,f)}let Q=!1,Z=!1;r.current&&((d=r.current)!=null&&d.isEditableElement?(Q=!0,(((t=r.current)==null?void 0:t.editableElementSelectionText)||((g=o.getSelection())==null?void 0:g.toString())||((C=document.getSelection())==null?void 0:C.toString()))&&(Z=!0)):(h=r.current)!=null&&h.selectionText&&(Q=!0,Z=!0),Q&&(n({selectionText:((x=r.current)==null?void 0:x.editableElementSelectionText)||r.current.selectionText,selectionHTML:((O=r.current)==null?void 0:O.editableElementSelectionText)||r.current.selectionHTML,selectionRect:r.current.selectionRect,activeElement:r.current.target,selectionInputAble:(U=r.current)==null?void 0:U.isEditableElement,selectionElement:r.current}),T.info("save selection temp data",(W=r.current)==null?void 0:W.isEditableElement,`
`,(M=r.current)==null?void 0:M.editableElementSelectionText,`
`,(L=r.current)==null?void 0:L.selectionText)),Z?(T.info("show floating button"),i()):(T.info("hide floating button"),l()))}},[o,n,i,l]);(0,p.useEffect)(()=>{let a=B(b,200),m=B(b,200),d=t=>{var x;let g=t.target,{isEditableElement:C,editableElement:h}=H(g);if(C&&h){if((x=w.current)!=null&&x.isSameNode(h))return;w.current&&(w.current.removeEventListener("mouseup",a),w.current.removeEventListener("keyup",m)),T.info("save targetElement ref",h),w.current=h,h.addEventListener("mouseup",a),h.addEventListener("keyup",m)}else T.info("clear targetElement ref"),w.current=null};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d),w.current&&(w.current.removeEventListener("mouseup",a),w.current.removeEventListener("keyup",m))}},[o,b,y,E==null?void 0:E.shortcutHintEnable]),(0,p.useEffect)(()=>{let a=B(b,200),m=B(b,200),d=()=>{};return o!=null&&o.initialized&&(document.addEventListener("mouseup",a),document.addEventListener("keyup",m),d=Ge(t=>{if(!t.selectionText&&(l(),!t.isEditableElement)){r.current=null;return}r.current=t,t.selectionText&&(t.eventType==="mouseup"?a({target:null}):m({target:null})),t.isEmbedPage&&t.selectionText&&(t==null?void 0:t.tagName)==="BUTTON"&&re(),t.selectionText||D(g=>({...g,open:!1}))})),()=>{document.removeEventListener("mouseup",a),document.removeEventListener("keyup",m),d()}},[o,b,re]),ye(async(a,m,d)=>{var t,g,C,h,x;switch(a){case"Client_listenOpenChatMessageBox":{let O=(t=window.getSelection())==null?void 0:t.rangeCount;if(O&&O>0){let M=(C=(g=window.getSelection())==null?void 0:g.getRangeAt(0))==null?void 0:C.cloneRange();ae({range:M||null})}let{command:U}=m,W=U==="show-floating-menu";if(!r.current){let M=oe(),{editableElement:L,isEditableElement:f}=H(M);f&&L&&(r.current=ne(L,{target:L,eventType:"keyup"}))}return T.info("Client_listenOpenChatMessageBox",(h=r.current)==null?void 0:h.isEditableElement,(x=r.current)==null?void 0:x.selectionText),Ze(r.current,{},W),r.current&&(r.current=null),{success:!0,data:{},message:""}}break}});let X=(0,p.useRef)("");(0,p.useEffect)(()=>{X.current=N.lastOutput},[N.lastOutput]);let ce=(0,p.useRef)(u==null?void 0:u.selectionElement);(0,p.useEffect)(()=>{ce.current=u==null?void 0:u.selectionElement},[u]),(0,p.useEffect)(()=>{let a=ce.current||r.current,m=["REPLACE_SELECTION","INSERT_BELOW","INSERT","INSERT_ABOVE","DISCARD","COPY"],d=Me(N.selectContextMenuId||"");if(!!d)switch(m.includes(d)&&(D({open:!1,rootRect:null}),Qe({selectContextMenuId:"",lastOutput:""}),l(),r.current=null),d){case"INSERT_BELOW":case"INSERT":case"INSERT_ABOVE":case"REPLACE_SELECTION":a&&st.postMessage({event:"Client_updateIframeInput",data:{value:X.current,type:d,startMarkerId:a.startMarkerId,endMarkerId:a.endMarkerId,caretOffset:a.caretOffset}});break;case"TRY_AGAIN":Xe(t=>{if(t.draftList.length===0)return t;let g=Ee(t.draftList);return g.pop(),{draft:g.join(`

`).replace(/\n{2,}/,`

`),draftList:g}});break;case"COPY":try{let t=document.createElement("textarea");t.style.cssText=`
              position: fixed;
              top: 0;
              left: 0;
              width: 1px;
              height: 1px;
              padding: 0;
              border: none;
              outline: none;
              boxShadow: none;
              background: transparent;
              z-index: -1;
            `,t.value=X.current,document.body.appendChild(t),t.select(),document.execCommand("copy",!1,""),t.remove()}catch(t){}break;default:break}},[N.selectContextMenuId])},Ye=at;var se=A(tt());var $e=A(z()),lt=()=>{let{setShortCuts:s,runShortCuts:c,loading:o}=Ae("");(0,$e.useEffect)(()=>{let i=async l=>{var n;if(((n=l.data)==null?void 0:n.id)==="USECHATGPT_WEB_INJECT"){let{taskId:u,type:S,data:E}=l.data;switch(S){case"ping":window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"pong",taskId:u,data:{success:!0}},l.origin);break;case"runShortCutActions":{let{actions:y}=E;o?window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:u,data:{success:!1,error:"shortcuts is running"}},l.origin):(await s(y),await c(!0),window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:u,data:{success:!0,error:""}},l.origin));break}}}};return window.addEventListener("message",i),()=>{window.removeEventListener("message",i)}},[o,s,c])},Ke=lt;var ct=new Y("AppInit"),ut=()=>window.location.host!=="www.usechatgpt.ai"&&window.location.host!=="www.maxai.me"?e.default.createElement(e.default.Fragment,null):e.default.createElement($,{onClick:()=>{_({key:"shortcuts"})},id:"usechatgpt-www-to-shortcuts",sx:{position:"absolute",width:1,height:1,zIndex:-1,opacity:0}}),mt=()=>(Ye(),e.default.createElement(e.default.Fragment,null)),dt=()=>{let s=R(J),c=R(Te);return Je(),(0,e.useEffect)(()=>{let o=async()=>{var l;let i=await we();if(i){if(s({...i}),ct.info("get settings",i),i.userSettings&&!((l=i.userSettings)!=null&&l.colorSchema)){let n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";await Se({userSettings:{...i.userSettings,colorSchema:n}}),s({...i,userSettings:{...i.userSettings,colorSchema:n}})}i!=null&&i.currentModel&&c(n=>({...n,model:i.currentModel||""}))}};return o(),window.addEventListener("focus",o),()=>{window.removeEventListener("focus",o)}},[]),e.default.createElement(e.default.Fragment,null)},ft=()=>{let[s,c]=e.default.useState(null),o=e.default.useRef(!1);F(()=>{window.location.href.startsWith("chrome-extension://")&&window.location.href.includes("/pages/pdf/web/viewer.html")&&c(100)}),We(()=>{let i=document.body.querySelector("#usechatgptPDFViewerErrorAlert");if(i){if(o.current)return;o.current=!0,c(null);let l=i.getAttribute("data-url");(0,se.render)(e.default.createElement(v,{spacing:2,p:2,width:"100%",sx:{boxSizing:"border-box"}},e.default.createElement(v,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1.4,color:"#fff"},e.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:48,width:48,src:"/assets/USE_CHAT_GPT_AI/icons/maxai_48_normal_dark.png"}),e.default.createElement(I,{variant:"body1",fontSize:18,fontWeight:700},"PDF AI viewer")),e.default.createElement(v,{alignItems:"center",spacing:0},e.default.createElement(I,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},'PDF Al viewer lets you select any text in local PDF files and use prompts on them. Click on "Allow access to file URLs" at ',e.default.createElement(K,{color:"rgba(255,255,255,1)",href:"#",onClick:async n=>{n.preventDefault(),await _({key:"manage_extension"}),window.close()}},"chrome://extensions")," to "),e.default.createElement(I,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:2}},`view ${l}`),e.default.createElement(te,{mb:2},e.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:`${ee}/extension/pdf/guide1.gif`})),e.default.createElement($,{disableElevation:!0,size:"small",variant:"contained",onClick:async n=>{n.preventDefault(),await _({key:"manage_extension"}),window.close()},sx:{height:"56px",backgroundColor:"#7601D3",color:"#fff",fontSize:"18px",textTransform:"none",px:3,"&:hover":{backgroundColor:"#7601D3",color:"#fff"}}},"Allow access to file URLs")),e.default.createElement(De,{sx:{color:"#fff"}},"OR"),e.default.createElement(v,{spacing:2},e.default.createElement(I,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},`You can turn off "PDF AI viewer" at any time on the extension's `,e.default.createElement(K,{color:"rgba(255,255,255,1)",href:"#",onClick:async n=>{n.preventDefault(),n.stopPropagation(),await _({key:"options",query:"#pdf"}),window.close()}},"Settings page"),"."),e.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:`${ee}/extension/pdf/guide2.gif`}))),i);return}},s)},pt=()=>{if(window.location.href.startsWith("chrome-extension://")&&window.location.href.includes("/pages/pdf/web/viewer.html")){if(document.body.querySelector("#usechatgpt-disabled-pdf")||window.localStorage.getItem("hide_usechatgptai_pdf_alert")==="true")return;let s=e.default.createElement(te,{position:"fixed",right:8,top:40,zIndex:1e4,id:"usechatgpt-disabled-pdf"},e.default.createElement(Oe,{icon:e.default.createElement(e.default.Fragment,null),action:e.default.createElement(e.default.Fragment,null),sx:{p:"8px!important",bgcolor:"#fff",border:"1px solid #7601D3","& > div":{"&:first-of-type":{display:"none"},"&:nth-of-type(2)":{padding:"0!important"},"&:last-of-type":{margin:"0!important",padding:"0!important",position:"absolute",top:0,right:0}},"& *":{color:"#7601D3"}}},e.default.createElement(v,{spacing:1,maxWidth:320},e.default.createElement(v,{direction:"row",alignItems:"center",spacing:1},e.default.createElement(xe,{sx:{fontSize:14}}),e.default.createElement(I,{variant:"body1",fontSize:14,fontWeight:700},"PDF AI viewer")),e.default.createElement(I,{fontSize:14},`PDF AI viewer lets you select any text in local PDF files and use
                prompts on them. You can turn it off at any time on the
                extension's `,e.default.createElement(K,{href:"#",onClick:async o=>{o.preventDefault(),o.stopPropagation(),await _({key:"options",query:"#pdf"})}},"Settings page"),"."),e.default.createElement($,{size:"small",disableElevation:!0,sx:{bgcolor:"#7601D3",color:"#fff","&:hover":{bgcolor:"#7601D3"},textTransform:"none"},onClick:async()=>{var o;window.localStorage.setItem("hide_usechatgptai_pdf_alert",JSON.stringify(!0)),(o=document.body.querySelector("#usechatgpt-disabled-pdf"))==null||o.remove()}},"Got it")))),c=document.createElement("div");document.body.appendChild(c),(0,se.render)(s,c)}},gt=e.default.lazy(()=>import("./56SW7Y5D.js")),Et=()=>{let s=V(ge);return Ue(),ke(),F(()=>{pt(),he().then().catch()}),Ke(),ft(),e.default.createElement(e.default.Fragment,null,e.default.createElement(Pe,null,s.env==="gmail"&&e.default.createElement(gt,null)),e.default.createElement(mt,null),e.default.createElement(Ne,null),e.default.createElement(dt,null),e.default.createElement(ut,null))},pn=Et;export{dt as a,pn as b};
