import{a as ke}from"./OMDQAR7O.js";import{F as fe,K as de,L as ge,M as he,N as xe,O as Ce,V as be,Z as Se,_ as ve,fa as Te,h as ue,ka as Me,la as Qe,ma as Ie,p as pe,qa as Be,t as F,ua as Ee,va as we}from"./36BQJYSV.js";import{c as me,f as ye}from"./EF5GRFCD.js";import"./I2XYMP7X.js";import{x as Q}from"./VV54QQJA.js";import{k as Ae}from"./WZUFDNVB.js";import{f as ae}from"./5T4V74FX.js";import{a as C,k as V}from"./KSWBD2TZ.js";import"./RF7QDMRO.js";import"./ABULMT32.js";import{d as P}from"./MKFZQTYG.js";import{b as le}from"./4SC7XEKB.js";import{D as N,a as M,r as _}from"./23DIE7BK.js";import{a as Z,i as ne}from"./ON4Q5ESC.js";import"./REMB6LXX.js";import{v as se}from"./BK6QTIUI.js";import{M as ie,T as $,W as L,ga as ce}from"./VYGUKUEK.js";import{d as G,i as re}from"./X6PP3PBE.js";import"./JS22TWPO.js";import{M as oe,d as R,e as ee,j as z,y as te}from"./BR2YNKDZ.js";import{a as k}from"./BIAB2ZEP.js";import{b as J,e as A}from"./O5NYTI7P.js";var _e=J(j=>{"use strict";var Ve=Z();Object.defineProperty(j,"__esModule",{value:!0});j.default=void 0;var Xe=Ve(le()),Ke=ne(),Je=(0,Xe.default)((0,Ke.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"}),"Cached");j.default=Je});var Pe=J(U=>{"use strict";var Ze=Z();Object.defineProperty(U,"__esModule",{value:!0});U.default=void 0;var Re=Ze(le()),et=ne(),tt=(0,Re.default)((0,et.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"}),"Block");U.default=tt});var H=A(k());var e=A(k());var Fe=A(_e());var je=A(Pe());var a=A(k());var Le=A(Qe());var ot=m=>{let{onSendMessage:r}=m,[i,s]=(0,a.useState)(""),l=G(ue),c=a.default.useRef(null),g=(0,a.useRef)(!1),f=(0,a.useMemo)(()=>4e3,[]),x=(0,a.useMemo)(()=>i.length>f,[i,f]),h=(0,a.useRef)({});return(0,a.useEffect)(()=>{let b=(o,T)=>{T&&(h.current=T),o.startsWith("``NO_HISTORY_&#``\n")&&(o=o.replace("``NO_HISTORY_&#``\n",""),g.current=!0),s(o)};return Q("chatBoxInputMediator").subscribe(b),()=>{Q("chatBoxInputMediator").unsubscribe(b)}},[]),(0,a.useEffect)(()=>{g.current=!1,h.current={}},[l.loading]),a.default.createElement(M,{ref:c,p:1,pt:0,direction:"row",alignItems:"center",spacing:1,width:"100%"},a.default.createElement(_,{component:"span",color:x?"rgb(239, 83, 80)":"text.secondary",fontSize:12,fontFamily:"Roboto,RobotoDraft,Helvetica,Arial,sans-serif!important"},l.loading?0:$(i.length,0),"/",$(f,0)),a.default.createElement(C,{component:"div",display:"flex",width:0,flex:1,alignItems:"center",justifyContent:"end",gap:1},!ee&&!l.loading&&a.default.createElement(ke,{onBeforeShowContextMenu:()=>{var b,o;return{template:i||" ",target:((o=(b=L())==null?void 0:b.querySelector(`#${z}`))==null?void 0:o.parentElement)||c.current}}}),a.default.createElement(Ae,{title:"Send to AI",TooltipProps:{description:"\u23CE"},sx:{minWidth:"unset",p:1},disableElevation:!0,variant:"contained",disabled:l.loading,onClick:()=>{r&&r(i,{includeHistory:!g.current,meta:h.current}),h.current={},g.current=!1}},l.loading?a.default.createElement(me,{size:16}):a.default.createElement(Le.default,{sx:{fontSize:"16px"}}))))},He=ot;var d=A(k()),rt=(m,r,i)=>{let s=(0,d.useRef)(null),l=(0,d.useRef)(null),[c,g]=(0,d.useState)(1),[f]=(0,d.useState)((i==null?void 0:i.buffer)||10),x=(i==null?void 0:i.buffer)||0,h=(0,d.useCallback)(()=>{if(s.current&&s.current.disconnect(),m.current){let u=m.current,S=null,B=()=>{S&&window.clearTimeout(S);let v=u.children[x];if(v){let E=D=>{D[0].isIntersecting&&o()};s.current=new IntersectionObserver(E),l.current=v,s.current.observe(v)}else S=window.setTimeout(()=>{B()},1e3)};B()}},[x]),b=(0,d.useCallback)(()=>{let u=m.current;if(s.current&&u){l.current&&s.current.unobserve(l.current);let S=u.children[x];S&&s.current.observe(S)}},[m,x]),o=(0,d.useCallback)(()=>{g(u=>++u)},[]),T=(0,d.useMemo)(()=>f===-1?r:r.slice(-(c*f)),[r,c,f]);return(0,d.useEffect)(()=>{b()},[T]),(0,d.useEffect)(()=>(r.length>f&&m.current&&h(),()=>{s.current&&s.current.disconnect()}),[h,r,f,m]),{slicedMessageList:T,loadMore:o,changePageNumber:(0,d.useCallback)(u=>g(u),[])}},De=rt;var q=A(k());var nt=()=>q.default.createElement(_,{width:"100%",component:"div",fontSize:12,color:"text.secondary",sx:{display:"flex",alignItems:"center",justifyContent:"end"}},q.default.createElement(_,{fontSize:"inherit",color:"inherit",width:0,flex:1,textAlign:"right",noWrap:!0},q.default.createElement(N,{fontSize:"inherit",color:"inherit",href:oe,target:"_blank",sx:{textDecoration:"underline!important"}},`MaxAI.me v${R} - Use Claude-2-100K via Claude.ai`))),Oe=nt;var n=A(k());var it=m=>{let{onClick:r,disabledMainButton:i}=m,[s,l]=(0,n.useState)(!1),c=()=>{l(!1),setTimeout(()=>{r&&r("focus")},100)};return n.default.createElement(C,{sx:{position:"absolute",left:0,bottom:0,width:40,height:40}},n.default.createElement(Se,{ariaLabel:"SpeedDial controlled open",sx:{position:"absolute",left:0,bottom:"4px","& button":{width:36,height:36,minHeight:36},"& > button":{width:40,height:40}},icon:n.default.createElement(C,{component:"div",onClick:()=>{if(i){r&&r("focus");return}r&&r("new")}},n.default.createElement(V,{placement:"left",title:"New chat"},n.default.createElement(M,{p:1,alignItems:"center",justifyContent:"center",component:"div"},n.default.createElement(ae,{sx:{color:"#fff",fontSize:"24px"}}))))},n.default.createElement(ve,{icon:n.default.createElement(C,{component:"div",onClick:()=>{l(!0)}},n.default.createElement(V,{placement:"left",title:"Restart extension"},n.default.createElement(M,{p:1,alignItems:"center",justifyContent:"center",component:"div"},n.default.createElement(F,{icon:"Restart"})))),tooltipTitle:""})),n.default.createElement(de,{open:s,onClose:()=>{c()},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.default.createElement(Ce,{id:"alert-dialog-title"},"Restart MaxAI.me extension?"),n.default.createElement(he,null,n.default.createElement(xe,{id:"alert-dialog-description"},"A quick extension restart can clear all existing glitches.",n.default.createElement("br",null),"Don't forget to reload all pages to activate the extension afterwards.")),n.default.createElement(ge,null,n.default.createElement(P,{sx:{},variant:"outlined",onClick:()=>{c()}},"Cancel"),n.default.createElement(P,{color:"primary",variant:"contained",onClick:()=>{r&&r("restart"),c()},autoFocus:!0},"Restart"))))},Ge=it;var I=A(k());var st=m=>{let{sx:r}=m,i=G(re),[s,l]=I.default.useState(null),c=(0,I.useRef)(null),g=(0,I.useRef)(!1),f=(0,I.useRef)(!1),x=o=>{f.current||l(o.currentTarget)},h=()=>{l(null)},b=Boolean(s);return I.default.createElement(C,{id:"max-ai__ai-provider-floating-button",sx:{width:"44px",height:"44px",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",border:"1px solid #EBEBEB",cursor:"pointer",borderColor:o=>o.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"#EBEBEB",bgcolor:o=>o.palette.mode==="dark"?"#333":"#fff",boxShadow:"0px 0px 0.5px 0px rgba(0, 0, 0, 0.40), 0px 1px 3px 0px rgba(0, 0, 0, 0.09), 0px 4px 8px 0px rgba(0, 0, 0, 0.09);",...r},"aria-owns":b?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:o=>{c.current&&clearTimeout(c.current),g.current=!0,c.current=setTimeout(()=>{g.current=!1},700),x(o)},onMouseLeave:()=>{h(),f.current=!1}},I.default.createElement(Ie,{aiProviderType:i.chatGPTProvider||"USE_CHAT_GPT_PLUS"}),I.default.createElement(be,{open:b,anchorEl:s,id:"mouse-over-popover",anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},PaperProps:{sx:{ml:"8px"}}},I.default.createElement(fe.default,{onClickAway:o=>{var u;let T=(u=L())==null?void 0:u.querySelector("#MaxAIProviderSelectorCard");if(T){let S=T.getBoundingClientRect(),B=o.clientX,v=o.clientY;if(B>S.left&&B<S.right&&v>S.top&&v<S.bottom)return;h()}}},I.default.createElement(C,{onMouseEnter:x,onMouseLeave:h},I.default.createElement(Ee,{closeAble:!0,onClose:()=>{g.current||(f.current=!0,h())}})))))},ze=st;var Ne=e.default.lazy(()=>import("./IBXVZVMY.js")),at=m=>{let{sx:r,aiAvatar:i,userAvatar:s,onCopy:l,onQuestionUpdate:c,editAble:g=!0,insertAble:f=!0,reGenerateAble:x=!0,onReGenerate:h,onStopGenerate:b,onSendMessage:o,writingMessage:T,messages:u,onRetry:S,onReset:B,loading:v}=m,E=(0,e.useRef)(null),D=(0,e.useRef)(null),[X,qe]=e.default.useState(!1),{slicedMessageList:W,changePageNumber:K}=De(D,u),w=(0,e.useRef)(!0),O=(0,e.useCallback)((t,p)=>{K(1),o&&o(t,p)},[o,K]);(0,e.useEffect)(()=>{let t=E.current;if(!t)return;let y=se(We=>{if(We.deltaY<0){w.current=!1;return}let Ye=t.scrollTop,$e=t.scrollHeight;t.clientHeight+Ye>=$e&&(w.current=!0)},100);return t.addEventListener("wheel",y),()=>t.removeEventListener("wheel",y)},[]),(0,e.useEffect)(()=>{let t=E.current;w.current&&t&&t.scrollTo(0,t.scrollHeight)},[T]);let Y=(0,e.useRef)("");return(0,e.useEffect)(()=>{if(u.length>0){qe(u[u.length-1].type==="ai");for(let t=u.length-1;t>=0;t--){let p=u[t];if(p.type==="user"||p.type==="system"){let y=E.current;Y.current&&Y.current!==p.messageId?(w.current=!0,setTimeout(()=>{y&&y.scrollTo(0,y.scrollHeight)},0)):(w.current=!0,setTimeout(()=>{y&&y.scrollTo(0,y.scrollHeight)},0)),Y.current=p.messageId;break}}}},[u]),(0,e.useEffect)(()=>{let t=()=>{let p=E.current;p&&(w.current&&p.scrollTo(0,p.scrollHeight),setTimeout(()=>{w.current&&p.scrollTo(0,p.scrollHeight)},1e3))};return t(),window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[]),e.default.createElement(M,{position:"relative",borderTop:"1px solid",borderColor:"customColor.borderColor",sx:{height:0,flex:1,"& .MuiButton-root":{textTransform:"none"},...r}},e.default.createElement(C,{ref:E,flex:1,height:0,sx:{textAlign:"left",overflowY:"auto"}},e.default.createElement(C,{ref:D},e.default.createElement(ye,null,W.map(t=>e.default.createElement(Ne,{className:`use-chat-gpt-ai__message-item use-chat-gpt-ai__message-item--${t.type}`,insertAble:f,replaceAble:!0,message:t,aiAvatar:i,editAble:g,userAvatar:s,useChatGPTAble:!0,key:t.messageId,onSave:p=>{c&&c(t.messageId,p)},onRetry:S,onCopy:l})),T&&e.default.createElement(Ne,{className:"use-chat-gpt-ai__writing-message-item",replaceAble:!1,insertAble:!1,message:T,useChatGPTAble:!1,aiAvatar:i,editAble:!1,userAvatar:s})))),e.default.createElement(C,{height:8,flexShrink:0}),e.default.createElement(M,{className:"use-chat-gpt-ai__chat-box__input-box",position:"relative",mt:"auto",justifyContent:"center",alignItems:"center",minHeight:60,spacing:1,p:1,flexShrink:0},e.default.createElement(M,{width:"100%",alignItems:"center",justifyContent:"center"},e.default.createElement(C,{sx:{width:"100%"},component:"div",display:"flex",width:0,flex:1,alignItems:"center",justifyContent:"center",gap:1,mb:1,position:"relative"},e.default.createElement(Ge,{disabledMainButton:v||W.length===0,onClick:async t=>{var p;if(t==="focus"){let y=(p=L())==null?void 0:p.querySelector(`#${z}`);y&&y.focus()}else t==="new"?B&&B():t==="restart"&&await ce()}}),e.default.createElement(ze,{sx:{position:"absolute",bottom:0,right:0}}),!v&&W.length>0&&e.default.createElement(e.default.Fragment,null,x&&e.default.createElement(P,{disableElevation:!0,startIcon:e.default.createElement(Fe.default,null),variant:"outlined",disabled:v,onClick:()=>{h&&h()}},"Regenerate"),X&&e.default.createElement(P,{disableElevation:!0,startIcon:e.default.createElement(F,{icon:"FastForward"}),variant:"outlined",disabled:v,onClick:()=>{O&&O("Continue",{includeHistory:!0,regenerate:!1})}},"Continue")),v&&e.default.createElement(P,{sx:{mb:1},disableElevation:!0,variant:"outlined",startIcon:e.default.createElement(je.default,null),onClick:()=>{b&&b()}},"Stop generating")),e.default.createElement(pe,{sx:{minHeight:80},stopPropagation:!0,loading:v,expandNode:e.default.createElement(Me,{direction:"column",size:"small"}),onEnter:O},e.default.createElement(He,{onSendMessage:O}))),e.default.createElement(M,{direction:"row",alignItems:"center",sx:{width:"100%"},spacing:2,justifyContent:"space-between"},e.default.createElement(_,{sx:{flexShrink:0},fontSize:12},e.default.createElement(N,{color:"text.primary",sx:{cursor:"pointer"},underline:"always",target:"_blank",href:te},"Contact us")),e.default.createElement(Oe,null))))},Ue=at;var lt=()=>{let{sendQuestion:m,conversation:r,messages:i,reGenerate:s,retryMessage:l,stopGenerateMessage:c,resetConversation:g}=Be("");return(0,H.useEffect)(()=>{ie()},[]),H.default.createElement(M,{flex:1,height:0,position:"relative"},H.default.createElement(we,null),H.default.createElement(Ue,{editAble:!1,insertAble:!1,onSendMessage:async(f,x)=>{await m({question:f},{...x,regenerate:!1,includeHistory:x.includeHistory===!0})},writingMessage:r.writingMessage,messages:i,loading:r.loading,title:"Chat Draft",onRetry:l,onReGenerate:s,onStopGenerate:c,onReset:g}))},Eo=lt;export{Eo as default};
